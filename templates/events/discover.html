{% extends "base.html" %}
{% load slippers %}
{% load i18n %}

{% block title %}{% trans "Discover Events Near You" %} | Reckot{% endblock %}
{% block meta_description %}Find and book tickets for amazing events happening in Africa. Conferences, concerts, workshops, and more. Browse upcoming events on Reckot.{% endblock %}
{% block meta_keywords %}discover events, find events, events near me, Africa events, concerts, conferences, workshops, ticket booking{% endblock %}
{% block og_title %}Discover Events Near You | Reckot{% endblock %}
{% block og_description %}Find and book tickets for amazing events happening in Africa. Conferences, concerts, workshops, and more.{% endblock %}
{% block twitter_title %}Discover Events Near You | Reckot{% endblock %}
{% block twitter_description %}Find and book tickets for amazing events happening in Africa. Browse upcoming events on Reckot.{% endblock %}

{% load static %}

{% block extra_head %}
<script id="events-data" type="application/json">{{ events_json|safe }}</script>
<script id="categories-data" type="application/json">{{ categories_json|safe }}</script>
{% endblock %}

{% block content %}

<div class="container mx-auto px-4 py-8" x-data="discover()" @input.debounce.300ms="filterEvents()">
    <div class="text-center mb-6 sm:mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold mb-2">{% trans "Discover Events" %}</h1>
        <p class="text-sm sm:text-base text-muted-foreground">{% trans "Find amazing events happening near you" %}</p>
    </div>

    <div class="mb-6 sm:mb-8 space-y-3 sm:space-y-4" x-data="{ filtersOpen: false }">
        <div class="max-w-4xl mx-auto">
            <div class="flex gap-2">
                <div class="flex-1">
                    {% #input type="text" placeholder="Search events..." attrs='x-model="searchQuery"' %}{% /input %}
                </div>
                <button @click="filtersOpen = !filtersOpen"
                        class="btn btn-ghost sm:hidden shrink-0 px-3"
                        :class="filtersOpen ? 'bg-muted' : ''">
                    <i data-lucide="filter" class="w-4 h-4"></i>
                </button>
            </div>

            <div :class="filtersOpen ? 'block' : 'hidden sm:block'" class="mt-3 sm:mt-0 space-y-3">
                <div class="flex flex-col sm:flex-row gap-3 sm:mt-3">
                    <div class="flex-1">
                        {% #input type="text" placeholder="Location..." attrs='x-model="locationQuery"' %}{% /input %}
                    </div>
                    <div class="flex-1">
                        <select x-model="selectedDate" @change="filterEvents()" class="input w-full">
                            <option value="all">{% trans "All Dates" %}</option>
                            <option value="today">{% trans "Today" %}</option>
                            <option value="week">{% trans "This Week" %}</option>
                            <option value="month">{% trans "This Month" %}</option>
                        </select>
                    </div>
                </div>

                <div class="flex flex-wrap gap-2" x-show="categories.length > 0">
                    <button type="button" @click="selectedCategory = ''; filterEvents()" :class="selectedCategory === '' ? 'bg-foreground text-background' : ''" class="btn btn-ghost btn-sm text-xs sm:text-sm">
                        {% trans "All" %}
                    </button>
                    <template x-for="category in categories" :key="category.slug">
                        <button type="button" @click="selectedCategory = category.slug; filterEvents()" :class="selectedCategory === category.slug ? 'bg-foreground text-background' : ''" class="btn btn-ghost btn-sm flex items-center gap-1.5 text-xs sm:text-sm">
                            <i :data-lucide="category.icon || 'tag'" class="w-3.5 h-3.5 sm:w-4 sm:h-4"></i>
                            <span x-text="category.name"></span>
                        </button>
                    </template>
                </div>
            </div>
        </div>

        <div class="text-center text-xs sm:text-sm text-muted-foreground">
            <span x-text="filteredEvents.length"></span> {% trans "events found" %}
        </div>
    </div>

    <div x-show="filteredEvents.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <template x-for="event in filteredEvents" :key="event.id">
            <a :href="event.url" class="card hover:shadow-lg transition-shadow no-underline">
                <div x-show="event.cover_image" class="w-full h-48 overflow-hidden rounded-t-xl">
                    <img :src="event.cover_image" :alt="event.title" class="w-full h-full object-cover">
                </div>
                <div class="p-6">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex gap-2 flex-wrap">
                            <div x-show="event.category_name" class="badge badge-default">
                                <span x-text="event.category_name"></span>
                            </div>
                            <div :class="getEventStatus(event).class">
                                <span x-text="getEventStatus(event).label"></span>
                            </div>
                        </div>
                        <span x-show="event.min_price > 0" class="text-sm font-semibold text-foreground">
                            <span x-text="event.min_price"></span> XAF
                        </span>
                        <span x-show="event.is_free" class="text-sm font-semibold text-success">
                            {% trans "Free" %}
                        </span>
                    </div>
                    <h3 class="font-semibold text-lg mb-2 text-foreground" x-text="event.title"></h3>
                    <div class="text-sm text-muted-foreground mb-4 line-clamp-2" x-text="event.short_description"></div>
                    <div class="flex items-center gap-4 text-sm text-muted-foreground">
                        <span class="flex items-center gap-1">
                            <i data-lucide="clock" class="w-4 h-4"></i>
                            <span x-text="event.date_formatted"></span>
                        </span>
                        <span class="flex items-center gap-1">
                            <i data-lucide="map-pin" class="w-4 h-4"></i>
                            <span x-text="event.location_short"></span>
                        </span>
                    </div>
                </div>
            </a>
        </template>
    </div>

    <div x-show="filteredEvents.length === 0" class="text-center py-16">
        <div class="inline-flex h-16 w-16 items-center justify-center rounded-full bg-foreground/5 mb-4">
            <i data-lucide="calendar-x" class="w-8 h-8 text-muted-foreground"></i>
        </div>
        <h3 class="font-semibold text-lg mb-2">{% trans "No events found" %}</h3>
        <p class="text-muted-foreground">{% trans "Try adjusting your search criteria" %}</p>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/discover.js' %}"></script>
{% endblock %}
