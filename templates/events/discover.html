{% extends "base.html" %}
{% load slippers %}
{% load i18n %}

{% block title %}{% trans "Discover Events Near You" %} | Reckot{% endblock %}
{% block meta_description %}Find and book tickets for amazing events happening in Africa. Conferences, concerts, workshops, and more. Browse upcoming events on Reckot.{% endblock %}
{% block meta_keywords %}discover events, find events, events near me, Africa events, concerts, conferences, workshops, ticket booking{% endblock %}
{% block og_title %}Discover Events Near You | Reckot{% endblock %}
{% block og_description %}Find and book tickets for amazing events happening in Africa. Conferences, concerts, workshops, and more.{% endblock %}
{% block twitter_title %}Discover Events Near You | Reckot{% endblock %}
{% block twitter_description %}Find and book tickets for amazing events happening in Africa. Browse upcoming events on Reckot.{% endblock %}

{% load static %}

{% block content %}
<script id="events-data" type="application/json">{{ events_json|safe }}</script>
<script id="categories-data" type="application/json">{{ categories_json|safe }}</script>

<div class="container mx-auto px-4 py-8" data-controller="discover">
    <div class="text-center mb-6 sm:mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold mb-2">{% trans "Discover Events" %}</h1>
        <p class="text-sm sm:text-base text-muted-foreground">{% trans "Find amazing events happening near you" %}</p>
    </div>

    <div class="mb-6 sm:mb-8 space-y-3 sm:space-y-4" data-controller="toggle">
        <div class="max-w-4xl mx-auto">
            <div class="flex gap-2">
                <div class="flex-1">
                    {% #input type="text" placeholder="Search events..." attrs='data-discover-target="searchInput" data-action="input->discover#search"' %}{% /input %}
                </div>
                <button data-action="click->toggle#toggle"
                        class="btn btn-ghost sm:hidden shrink-0 px-3">
                    <i data-lucide="filter" class="w-4 h-4"></i>
                </button>
            </div>

            <div data-toggle-target="content" class="hidden sm:block mt-3 sm:mt-0 space-y-3">
                <div class="flex flex-col sm:flex-row gap-3 sm:mt-3">
                    <div class="flex-1">
                        {% #input type="text" placeholder="Location..." attrs='data-discover-target="locationInput" data-action="input->discover#searchLocation"' %}{% /input %}
                    </div>
                    <div class="flex-1">
                        <select data-discover-target="dateSelect" data-action="change->discover#selectDate" class="input w-full">
                            <option value="all">{% trans "All Dates" %}</option>
                            <option value="today">{% trans "Today" %}</option>
                            <option value="week">{% trans "This Week" %}</option>
                            <option value="month">{% trans "This Month" %}</option>
                        </select>
                    </div>
                </div>

                {% if categories %}
                <div class="flex flex-wrap gap-2">
                    <button type="button"
                            data-slug=""
                            data-discover-target="categoryButton"
                            data-action="click->discover#selectCategory"
                            class="btn btn-ghost btn-sm text-xs sm:text-sm bg-foreground text-background">
                        {% trans "All" %}
                    </button>
                    {% for category in categories %}
                        <button type="button"
                                data-slug="{{ category.slug }}"
                                data-discover-target="categoryButton"
                                data-action="click->discover#selectCategory"
                                class="btn btn-ghost btn-sm flex items-center gap-1.5 text-xs sm:text-sm bg-muted text-muted-foreground">
                            <i data-lucide="{{ category.icon|default:'tag' }}" class="w-3.5 h-3.5 sm:w-4 sm:h-4"></i>
                            <span>{{ category.name }}</span>
                        </button>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>

        <div class="text-center text-xs sm:text-sm text-muted-foreground">
            <span data-discover-count>{{ events|length }}</span> {% trans "events found" %}
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" data-discover-target="eventsList">
        {% for event in events %}
            <a href="{{ event.url }}" class="card hover:shadow-lg transition-shadow no-underline" data-event-id="{{ event.id }}">
                {% if event.cover_image %}
                <div class="w-full h-48 overflow-hidden rounded-t-xl">
                    <img src="{{ event.cover_image }}" alt="{{ event.title }}" class="w-full h-full object-cover">
                </div>
                {% endif %}
                <div class="p-6">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex gap-2 flex-wrap">
                            {% if event.category_name %}
                            <div class="badge badge-default">
                                <span>{{ event.category_name }}</span>
                            </div>
                            {% endif %}
                        </div>
                        {% if event.min_price > 0 %}
                        <span class="text-sm font-semibold text-foreground">
                            {{ event.min_price }} XAF
                        </span>
                        {% elif event.is_free %}
                        <span class="text-sm font-semibold text-success">
                            {% trans "Free" %}
                        </span>
                        {% endif %}
                    </div>
                    <h3 class="font-semibold text-lg mb-2 text-foreground">{{ event.title }}</h3>
                    <div class="text-sm text-muted-foreground mb-4 line-clamp-2">{{ event.short_description }}</div>
                    <div class="flex items-center gap-4 text-sm text-muted-foreground">
                        <span class="flex items-center gap-1">
                            <i data-lucide="clock" class="w-4 h-4"></i>
                            <span>{{ event.date_formatted }}</span>
                        </span>
                        <span class="flex items-center gap-1">
                            <i data-lucide="map-pin" class="w-4 h-4"></i>
                            <span>{{ event.location_short }}</span>
                        </span>
                    </div>
                </div>
            </a>
        {% endfor %}
    </div>

    <div class="text-center py-16 hidden" data-discover-target="emptyState">
        <div class="inline-flex h-16 w-16 items-center justify-center rounded-full bg-foreground/5 mb-4">
            <i data-lucide="calendar-x" class="w-8 h-8 text-muted-foreground"></i>
        </div>
        <h3 class="font-semibold text-lg mb-2">{% trans "No events found" %}</h3>
        <p class="text-muted-foreground">{% trans "Try adjusting your search criteria" %}</p>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
{% endblock %}
