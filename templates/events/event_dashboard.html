{% extends 'layouts/dashboard.html' %}
{% load slippers %}

{% block title %}{{ event.title }} - Dashboard - Reckot{% endblock %}

{% block breadcrumbs %}
{% #breadcrumb class="mb-4" %}
    {% #breadcrumb_item href="/" %}Home{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href="{% url 'events:list' %}" %}Events{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item %}{{ event.title|truncatewords:3 }}{% /breadcrumb_item %}
{% /breadcrumb %}
{% endblock %}

{% block header_title %}
<div>
    <h1 class="text-lg font-semibold line-clamp-1">{{ event.title }}</h1>
    <p class="text-sm text-muted-foreground">{{ event.organization.name }}</p>
</div>
{% endblock %}

{% block header_actions %}
<div class="flex items-center gap-2">
    {% if event.state == 'PUBLISHED' %}
    <span class="inline-flex items-center rounded-full border border-success/20 bg-success/10 text-success px-2.5 py-0.5 text-xs font-semibold">Live</span>
    {% elif event.state == 'DRAFT' %}
    <span class="inline-flex items-center rounded-full border border-border bg-muted text-muted-foreground px-2.5 py-0.5 text-xs font-semibold">Draft</span>
    {% else %}
    <span class="inline-flex items-center rounded-full border border-warning/20 bg-warning/10 text-warning px-2.5 py-0.5 text-xs font-semibold">{{ event.state }}</span>
    {% endif %}

    <a href="{% url 'events:public_detail' event.organization.slug event.slug %}" target="_blank">
        {% #button variant="outline" size="sm" %}
            <i data-lucide="external-link" class="w-4 h-4"></i>
            View Public
        {% /button %}
    </a>
</div>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        <div class="stat-card">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
                    <i data-lucide="ticket" class="h-5 w-5 text-blue-500"></i>
                </div>
                <div>
                    <p class="text-2xl font-bold">{{ stats.tickets_sold }}</p>
                    <p class="text-xs text-muted-foreground">Tickets Sold</p>
                </div>
            </div>
        </div>
        <div class="stat-card">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-lg bg-emerald-500/10 flex items-center justify-center">
                    <i data-lucide="wallet" class="h-5 w-5 text-emerald-500"></i>
                </div>
                <div>
                    <p class="text-2xl font-bold">{{ stats.revenue|floatformat:0 }} XAF</p>
                    <p class="text-xs text-muted-foreground">Revenue</p>
                </div>
            </div>
        </div>
        <div class="stat-card">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-lg bg-purple-500/10 flex items-center justify-center">
                    <i data-lucide="users" class="h-5 w-5 text-purple-500"></i>
                </div>
                <div>
                    <p class="text-2xl font-bold">{{ stats.checked_in }}</p>
                    <p class="text-xs text-muted-foreground">Checked In</p>
                </div>
            </div>
        </div>
        <div class="stat-card">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-lg bg-amber-500/10 flex items-center justify-center">
                    <i data-lucide="percent" class="h-5 w-5 text-amber-500"></i>
                </div>
                <div>
                    <p class="text-2xl font-bold">{{ stats.checkin_rate|floatformat:0 }}%</p>
                    <p class="text-xs text-muted-foreground">Check-in Rate</p>
                </div>
            </div>
        </div>
    </div>

    <div class="grid gap-6 lg:grid-cols-3">
        <div class="lg:col-span-2 space-y-6">
            <div class="card p-6">
                <h2 class="text-lg font-semibold mb-4">Quick Actions</h2>
                <div class="grid gap-3 sm:grid-cols-2">
                    <a href="{{ manage_tickets_url }}" hx-boost="false" class="flex items-center gap-3 p-3 rounded-lg border border-border hover:bg-muted transition-colors">
                        <div class="h-10 w-10 rounded-lg bg-muted flex items-center justify-center">
                            <i data-lucide="ticket" class="h-5 w-5"></i>
                        </div>
                        <div>
                            <p class="font-medium">Manage Tickets</p>
                            <p class="text-xs text-muted-foreground">Add or edit ticket types</p>
                        </div>
                    </a>
                    <a href="{{ checkin_url }}" hx-boost="false" class="flex items-center gap-3 p-3 rounded-lg border border-border hover:bg-muted transition-colors">
                        <div class="h-10 w-10 rounded-lg bg-muted flex items-center justify-center">
                            <i data-lucide="scan" class="h-5 w-5"></i>
                        </div>
                        <div>
                            <p class="font-medium">Check-in</p>
                            <p class="text-xs text-muted-foreground">Scan tickets at the door</p>
                        </div>
                    </a>
                    <a href="{{ export_url }}" hx-boost="false" class="flex items-center gap-3 p-3 rounded-lg border border-border hover:bg-muted transition-colors">
                        <div class="h-10 w-10 rounded-lg bg-muted flex items-center justify-center">
                            <i data-lucide="download" class="h-5 w-5"></i>
                        </div>
                        <div>
                            <p class="font-medium">Export Data</p>
                            <p class="text-xs text-muted-foreground">Download reports (PDF, CSV)</p>
                        </div>
                    </a>
                    <a href="{{ analytics_url }}" hx-boost="false" class="flex items-center gap-3 p-3 rounded-lg border border-border hover:bg-muted transition-colors">
                        <div class="h-10 w-10 rounded-lg bg-muted flex items-center justify-center">
                            <i data-lucide="bar-chart-3" class="h-5 w-5"></i>
                        </div>
                        <div>
                            <p class="font-medium">Analytics</p>
                            <p class="text-xs text-muted-foreground">View detailed reports</p>
                        </div>
                    </a>
                    <a href="{{ flyer_config_url }}" hx-boost="false" class="flex items-center gap-3 p-3 rounded-lg border border-border hover:bg-muted transition-colors">
                        <div class="h-10 w-10 rounded-lg bg-muted flex items-center justify-center">
                            <i data-lucide="image" class="h-5 w-5"></i>
                        </div>
                        <div>
                            <p class="font-medium">I Will Be There</p>
                            <p class="text-xs text-muted-foreground">Flyer generator for attendees</p>
                        </div>
                    </a>
                </div>
            </div>

            <div class="card p-6">
                <h2 class="text-lg font-semibold mb-4">Event Details</h2>
                <dl class="space-y-3 text-sm">
                    <div class="flex justify-between py-2 border-b border-border">
                        <dt class="text-muted-foreground">Date</dt>
                        <dd class="font-medium">{{ event.start_at|date:"F j, Y" }} at {{ event.start_at|time:"g:i A" }}</dd>
                    </div>
                    <div class="flex justify-between py-2 border-b border-border">
                        <dt class="text-muted-foreground">Location</dt>
                        <dd class="font-medium">{{ event.venue_name|default:event.location }}</dd>
                    </div>
                    <div class="flex justify-between py-2 border-b border-border">
                        <dt class="text-muted-foreground">Type</dt>
                        <dd class="font-medium">{{ event.get_event_type_display }}</dd>
                    </div>
                    <div class="flex justify-between py-2 border-b border-border">
                        <dt class="text-muted-foreground">Capacity</dt>
                        <dd class="font-medium">{% if event.capacity %}{{ event.capacity }}{% else %}Unlimited{% endif %}</dd>
                    </div>
                    <div class="flex justify-between py-2">
                        <dt class="text-muted-foreground">Visibility</dt>
                        <dd class="font-medium">{% if event.is_public %}Public{% else %}Private{% endif %}</dd>
                    </div>
                </dl>
            </div>
        </div>

        <div class="space-y-6">
            <div class="card p-6">
                <h2 class="text-lg font-semibold mb-4">Event Status</h2>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-foreground">Published</span>
                        {% if is_published %}
                        <span class="h-6 w-6 rounded-full bg-success flex items-center justify-center">
                            <i data-lucide="check" class="h-4 w-4 text-background"></i>
                        </span>
                        {% else %}
                        <span class="h-6 w-6 rounded-full bg-muted"></span>
                        {% endif %}
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-foreground">Public</span>
                        {% if event.is_public %}
                        <span class="h-6 w-6 rounded-full bg-success flex items-center justify-center">
                            <i data-lucide="check" class="h-4 w-4 text-background"></i>
                        </span>
                        {% else %}
                        <span class="h-6 w-6 rounded-full bg-muted"></span>
                        {% endif %}
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-foreground">Featured</span>
                        {% if event.is_featured %}
                        <span class="h-6 w-6 rounded-full bg-success flex items-center justify-center">
                            <i data-lucide="check" class="h-4 w-4 text-background"></i>
                        </span>
                        {% else %}
                        <span class="h-6 w-6 rounded-full bg-muted"></span>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% if event.is_public and not event.is_featured %}
            <div class="card p-6">
                <h2 class="text-lg font-semibold mb-2">Get Featured</h2>
                <p class="text-sm text-muted-foreground mb-4">Apply to have your event featured on the Reckot homepage for maximum visibility.</p>

                {% if event.feature_requested_at and not event.feature_rejection_reason %}
                <div role="alert" class="relative w-full rounded-lg border border-warning/50 text-warning bg-warning/10 p-4">
                    <i data-lucide="clock" class="h-4 w-4 absolute left-4 top-4"></i>
                    <div class="pl-7">
                        <div class="text-sm">Feature request pending review</div>
                    </div>
                </div>
                {% elif event.feature_rejection_reason %}
                <div role="alert" class="relative w-full rounded-lg border border-destructive/50 text-destructive bg-destructive/10 p-4">
                    <h5 class="mb-1 font-medium leading-none tracking-tight">Request declined</h5>
                    <div class="text-sm mt-1">{{ event.feature_rejection_reason }}</div>
                </div>
                <form method="post" action="{% url 'events:apply_feature' event.organization.slug event.slug %}" class="mt-3">
                    {% csrf_token %}
                    {% #button type="submit" variant="default" size="sm" class="w-full" %}
                        <i data-lucide="star" class="w-4 h-4"></i>
                        Re-apply for Feature
                    {% /button %}
                </form>
                {% else %}
                <form method="post" action="{% url 'events:apply_feature' event.organization.slug event.slug %}">
                    {% csrf_token %}
                    {% #button type="submit" variant="default" size="sm" class="w-full" %}
                        <i data-lucide="star" class="w-4 h-4"></i>
                        Apply for Feature
                    {% /button %}
                </form>
                {% endif %}
            </div>
            {% endif %}

            {% if event.is_featured %}
            <div class="card p-6 border-amber-500/50 bg-amber-500/5">
                <div class="flex items-center gap-2 mb-2">
                    <i data-lucide="star" class="w-5 h-5 text-amber-500"></i>
                    <h2 class="text-lg font-semibold">Featured Event</h2>
                </div>
                <p class="text-sm text-muted-foreground">Your event is currently featured on the homepage!</p>
                {% if event.feature_expires_at %}
                <p class="text-xs text-muted-foreground mt-2">Expires: {{ event.feature_expires_at|date:"M j, Y" }}</p>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
