{% extends 'layouts/dashboard.html' %}
{% load slippers %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Edit" %} {{ event.title }} - Reckot{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}

{% block breadcrumbs %}
{% url 'events:dashboard' org_slug=event.organization.slug event_slug=event.slug as dashboard_url %}
{% #breadcrumb class="mb-4" %}
    {% #breadcrumb_item href="/" %}{% trans "Home" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href="/events/" %}{% trans "Events" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href=dashboard_url %}{{ event.title|truncatewords:3 }}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item %}{% trans "Edit" %}{% /breadcrumb_item %}
{% /breadcrumb %}
{% endblock %}

{% block header_title %}
<div class="min-w-0">
    <h1 class="text-lg font-semibold truncate">{% trans "Edit Event" %}</h1>
    <p class="text-sm text-muted-foreground hidden md:block">{{ event.title }}</p>
</div>
{% endblock %}

{% block header_actions %}
<a href="{% url 'events:dashboard' event.organization.slug event.slug %}">
    {% #button variant="outline" size="sm" %}
        <i data-lucide="arrow-left" class="w-4 h-4"></i>
        {% trans "Back to dashboard" %}
    {% /button %}
</a>
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto pb-24" data-controller="event-form" data-event-form-mode-value="edit">
    <div class="mb-8">
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium">Step <span data-step-number>1</span> of 5</span>
            <span class="text-sm text-muted-foreground" data-step-label>{% trans "Basic Info" %}</span>
        </div>
        <div class="h-2 bg-muted rounded-full overflow-hidden">
            <div data-event-form-target="progressBar" class="h-full bg-primary transition-all duration-300 rounded-full" style="width: 25%"></div>
        </div>
    </div>

    <form id="edit-event-form" method="post" enctype="multipart/form-data" hx-boost="false" data-action="submit->event-form#submitForm">
        {% csrf_token %}

        {% if form.errors %}
        <div class="rounded-lg bg-red-500/10 border border-red-500/20 p-4 text-sm text-red-500 mb-6">
            {% for field, error_list in form.errors.items %}
                {% for error in error_list %}
                    {% if field == '__all__' %}
                        <p>{{ error }}</p>
                    {% else %}
                        <p><strong>{{ field }}:</strong> {{ error }}</p>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </div>
        {% endif %}

        <div data-event-form-target="step1">
            <div class="card p-6 space-y-4">
                <h2 class="text-lg font-semibold">{% trans "Basic Information" %}</h2>
                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Organization" %}</label>
                    <div class="input bg-muted text-muted-foreground cursor-not-allowed flex items-center">
                        {{ event.organization.name }}
                    </div>
                    <p class="text-xs text-muted-foreground mt-1">{% trans "Organization cannot be changed" %}</p>
                </div>

                <div>
                    <label for="id_title" class="block text-sm font-medium mb-2">{% trans "Event Title" %} <span class="text-red-500">*</span></label>
                    <input type="text" name="title" id="id_title" required placeholder="{% trans "e.g., Tech Conference 2026" %}"
                           class="input"
                           data-action="input->event-form#clearError"
                           value="{{ event.title }}">
                    <p data-error="title" class="hidden text-sm text-red-500 mt-1"></p>
                </div>

                <div>
                    <label for="id_short_description" class="block text-sm font-medium mb-2">{% trans "Tagline" %}</label>
                    <input type="text" name="short_description" id="id_short_description"
                           placeholder="{% trans "A brief description (max 300 chars)" %}" maxlength="300" class="input"
                           value="{{ event.short_description|default:'' }}">
                </div>

                <div>
                    <label for="id_description" class="block text-sm font-medium mb-2">{% trans "Full Description" %} <span class="text-red-500">*</span></label>
                    <textarea name="description" id="id_description" rows="4" required
                              placeholder="{% trans "Tell attendees what to expect..." %}"
                              data-action="input->event-form#clearError"
                              data-richtext>{{ event.description|safe }}</textarea>
                    <p data-error="description" class="hidden text-sm text-red-500 mt-1"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Cover Image" %}</label>
                    <div class="border-2 border-dashed border-border rounded-lg p-6 text-center hover:border-muted-foreground/50 transition-colors cursor-pointer"
                         data-action="click->event-form#triggerFileInput">
                        {% if event.cover_image %}
                        <img data-event-form-target="coverPreview" src="{{ event.cover_image.url }}" class="max-h-40 rounded-lg object-cover mx-auto">
                        {% else %}
                        <div data-cover-placeholder>
                            <i data-lucide="image-plus" class="h-10 w-10 mx-auto text-muted-foreground mb-2"></i>
                            <p class="text-sm font-medium">{% trans "Click to upload or generate with AI" %}</p>
                            <p class="text-xs text-muted-foreground mt-1">{% trans "PNG, JPG. Recommended: 1200x630px (16:9)" %}</p>
                        </div>
                        <img data-event-form-target="coverPreview" class="hidden max-h-40 rounded-lg object-cover mx-auto">
                        {% endif %}
                    </div>
                    <input type="file" name="cover_image" accept="image/*" data-cover-input
                           data-action="change->event-form#handleCoverUpload" class="hidden">
                </div>
            </div>
        </div>

        <div data-event-form-target="step2" class="hidden">
            <div class="card p-6 space-y-4 card-overflow-visible">
                <h2 class="text-lg font-semibold">{% trans "Date & Time" %}</h2>

                <div class="grid gap-4 sm:grid-cols-2">
                    <div class="relative">
                        <label for="id_start_at" class="block text-sm font-medium mb-2">{% trans "Start" %} <span class="text-red-500">*</span></label>
                        <div class="relative">
                            <input type="text" name="start_at" id="id_start_at" required
                                   placeholder="{% trans "Select date and time" %}"
                                   class="input pl-10 flatpickr-datetime cursor-pointer"
                                   data-action="input->event-form#clearError"
                                   value="{{ event.start_at|date:'Y-m-d H:i' }}">
                            <div class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground">
                                <i data-lucide="calendar-clock" class="w-4 h-4"></i>
                            </div>
                        </div>
                        <p data-error="start_at" class="hidden text-sm text-red-500 mt-1"></p>
                    </div>
                    <div class="relative">
                        <label for="id_end_at" class="block text-sm font-medium mb-2">{% trans "End" %} <span class="text-red-500">*</span></label>
                        <div class="relative">
                            <input type="text" name="end_at" id="id_end_at" required
                                   placeholder="{% trans "Select date and time" %}"
                                   class="input pl-10 flatpickr-datetime cursor-pointer"
                                   data-action="input->event-form#clearError"
                                   value="{{ event.end_at|date:'Y-m-d H:i' }}">
                            <div class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground">
                                <i data-lucide="calendar-clock" class="w-4 h-4"></i>
                            </div>
                        </div>
                        <p data-error="end_at" class="hidden text-sm text-red-500 mt-1"></p>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Timezone" %}</label>
                    <div class="custom-select-wrapper" data-controller="dropdown" data-dropdown-value-value="{{ event.timezone|default:'Africa/Douala' }}" data-dropdown-label-value="{{ event.timezone|default:'Africa/Douala (WAT)' }}" data-action="click@window->dropdown#clickOutside">
                        <input type="hidden" name="timezone" value="{{ event.timezone|default:'Africa/Douala' }}" data-dropdown-target="hiddenInput">
                        <button type="button" data-dropdown-target="trigger" data-action="click->dropdown#toggle" class="custom-select-trigger">
                            <span class="custom-select-value">{{ event.timezone|default:"Africa/Douala (WAT)" }}</span>
                            <i data-lucide="chevron-down" class="custom-select-chevron w-4 h-4"></i>
                        </button>
                        <div data-dropdown-target="dropdown" class="custom-select-dropdown hidden">
                            <div class="custom-select-options">
                                <button type="button" data-dropdown-target="option" data-value="Africa/Douala" data-label="Africa/Douala (WAT)" data-action="click->dropdown#selectOption" class="custom-select-option{% if event.timezone == 'Africa/Douala' or not event.timezone %} custom-select-option-selected{% endif %}">
                                    <span>Africa/Douala (WAT)</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4{% if event.timezone != 'Africa/Douala' and event.timezone %} hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="Africa/Lagos" data-label="Africa/Lagos (WAT)" data-action="click->dropdown#selectOption" class="custom-select-option{% if event.timezone == 'Africa/Lagos' %} custom-select-option-selected{% endif %}">
                                    <span>Africa/Lagos (WAT)</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4{% if event.timezone != 'Africa/Lagos' %} hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="Europe/London" data-label="Europe/London (GMT)" data-action="click->dropdown#selectOption" class="custom-select-option{% if event.timezone == 'Europe/London' %} custom-select-option-selected{% endif %}">
                                    <span>Europe/London (GMT)</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4{% if event.timezone != 'Europe/London' %} hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="America/New_York" data-label="America/New_York (EST)" data-action="click->dropdown#selectOption" class="custom-select-option{% if event.timezone == 'America/New_York' %} custom-select-option-selected{% endif %}">
                                    <span>America/New_York (EST)</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4{% if event.timezone != 'America/New_York' %} hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="UTC" data-label="UTC" data-action="click->dropdown#selectOption" class="custom-select-option{% if event.timezone == 'UTC' %} custom-select-option-selected{% endif %}">
                                    <span>UTC</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4{% if event.timezone != 'UTC' %} hidden{% endif %}"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div data-event-form-target="step3" class="hidden">
            <div class="card p-6 space-y-4">
                <h2 class="text-lg font-semibold">{% trans "Location" %}</h2>

                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Event Type" %}</label>
                    <div class="custom-select-wrapper" data-controller="dropdown" data-dropdown-value-value="{{ event.event_type }}" data-dropdown-label-value="{{ event.get_event_type_display }}" data-action="click@window->dropdown#clickOutside">
                        <input type="hidden" name="event_type" value="{{ event.event_type }}" data-dropdown-target="hiddenInput" data-action="change->event-form#updateEventType">
                        <button type="button" data-dropdown-target="trigger" data-action="click->dropdown#toggle" class="custom-select-trigger">
                            <span class="custom-select-value">{{ event.get_event_type_display }}</span>
                            <i data-lucide="chevron-down" class="custom-select-chevron w-4 h-4"></i>
                        </button>
                        <div data-dropdown-target="dropdown" class="custom-select-dropdown hidden">
                            <div class="custom-select-options">
                                <button type="button" data-dropdown-target="option" data-value="IN_PERSON" data-label="{% trans 'In Person' %}" data-action="click->dropdown#selectOption" class="custom-select-option{% if event.event_type == 'IN_PERSON' %} custom-select-option-selected{% endif %}">
                                    <span>{% trans "In Person" %}</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4{% if event.event_type != 'IN_PERSON' %} hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="ONLINE" data-label="{% trans 'Online' %}" data-action="click->dropdown#selectOption" class="custom-select-option{% if event.event_type == 'ONLINE' %} custom-select-option-selected{% endif %}">
                                    <span>{% trans "Online" %}</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4{% if event.event_type != 'ONLINE' %} hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="HYBRID" data-label="{% trans 'Hybrid' %}" data-action="click->dropdown#selectOption" class="custom-select-option{% if event.event_type == 'HYBRID' %} custom-select-option-selected{% endif %}">
                                    <span>{% trans "Hybrid" %}</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4{% if event.event_type != 'HYBRID' %} hidden{% endif %}"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div data-location-fields class="space-y-4{% if event.event_type == 'ONLINE' %} hidden{% endif %}">
                    <div>
                        <label for="id_venue_name" class="block text-sm font-medium mb-2">{% trans "Venue Name" %}</label>
                        <input type="text" name="venue_name" id="id_venue_name" placeholder="{% trans "e.g., Convention Center" %}" class="input"
                               value="{{ event.venue_name|default:'' }}">
                    </div>

                    <div>
                        <label for="id_location" class="block text-sm font-medium mb-2">{% trans "Address" %} <span class="text-red-500">*</span></label>
                        <input type="text" name="location" id="id_location" placeholder="{% trans "Street address" %}"
                               class="input"
                               data-action="input->event-form#clearError"
                               value="{{ event.location|default:'' }}">
                        <p data-error="location" class="hidden text-sm text-red-500 mt-1"></p>
                    </div>

                    <div class="grid gap-4 sm:grid-cols-2">
                        <div>
                            <label for="id_city" class="block text-sm font-medium mb-2">{% trans "City" %}</label>
                            <input type="text" name="city" id="id_city" placeholder="{% trans "e.g., Yaounde" %}" class="input"
                                   value="{{ event.city|default:'' }}">
                        </div>
                        <div>
                            <label for="id_country" class="block text-sm font-medium mb-2">{% trans "Country" %}</label>
                            <input type="text" name="country" id="id_country" class="input"
                                   value="{{ event.country|default:'Cameroon' }}">
                        </div>
                    </div>
                </div>

                <div data-online-fields class="space-y-4{% if event.event_type == 'IN_PERSON' %} hidden{% endif %}">
                    <div>
                        <label for="id_online_url" class="block text-sm font-medium mb-2">{% trans "Meeting Link" %}</label>
                        <input type="url" name="online_url" id="id_online_url" placeholder="https://zoom.us/j/..." class="input"
                               value="{{ event.online_url|default:'' }}">
                        <p class="text-xs text-muted-foreground mt-1">{% trans "Zoom, Google Meet, etc." %}</p>
                    </div>
                </div>
            </div>
        </div>

        <div data-event-form-target="step4" class="hidden">
            <div class="card p-6 space-y-4">
                <h2 class="text-lg font-semibold">{% trans "Additional Details" %}</h2>

                <div>
                    <label for="id_capacity" class="block text-sm font-medium mb-2">{% trans "Capacity" %}</label>
                    <input type="number" name="capacity" id="id_capacity" min="0" required class="input"
                           value="{{ event.capacity|default:100 }}">
                    <p class="text-xs text-muted-foreground mt-1">{% trans "0 for unlimited" %}</p>
                </div>

                <div>
                    <label for="id_website" class="block text-sm font-medium mb-2">{% trans "Event Website" %}</label>
                    <input type="url" name="website" id="id_website" placeholder="https://event.com" class="input"
                           value="{{ event.website|default:'' }}">
                </div>

                <div data-controller="modal">
                    <div class="flex items-center justify-between gap-3 p-3 rounded-lg bg-muted/50 border border-border/50">
                        <div class="flex items-center gap-3">
                            <input type="checkbox" id="id_is_free_display" class="h-4 w-4 rounded border-border opacity-50 cursor-not-allowed"
                                   {% if event.is_free %}checked{% endif %} disabled>
                            <input type="hidden" name="is_free" value="{% if event.is_free %}on{% endif %}">
                            <label for="id_is_free_display" class="text-sm font-medium opacity-70 cursor-not-allowed">
                                {% trans "This is a free event" %}
                                <span class="text-xs text-muted-foreground ml-2">({% trans "Cannot be changed after creation" %})</span>
                            </label>
                        </div>
                        <button type="button"
                                data-action="click->modal#open"
                                class="text-xs px-3 py-1.5 rounded-lg border border-primary text-primary hover:bg-primary/10 transition-colors font-medium">
                            {% trans "Request Upgrade" %}
                        </button>
                    </div>

                    <div data-modal-target="container" class="fixed inset-0 z-50 overflow-y-auto hidden" role="dialog" aria-modal="true">
                        <div data-action="click->modal#close" class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity duration-200"></div>
                        <div class="fixed inset-0 flex items-center justify-center p-4">
                            <div class="relative w-full max-w-md bg-card border border-border rounded-xl shadow-xl transition-all duration-200">
                                <div class="flex items-start justify-between p-4 border-b border-border">
                                    <div class="flex-1 pr-4">
                                        <h3 class="text-lg font-semibold">{% trans "Request Plan Upgrade" %}</h3>
                                        <p class="text-sm text-muted-foreground mt-0.5">{% trans "Upgrade your plan to unlock more features" %}</p>
                                    </div>
                                    <button type="button" data-action="click->modal#close" class="shrink-0 p-2 -mr-2 -mt-1 rounded-lg hover:bg-muted transition-colors text-muted-foreground hover:text-foreground" aria-label="Close">
                                        <i data-lucide="x" class="w-5 h-5"></i>
                                    </button>
                                </div>
                                <div class="p-4">
                    <div class="space-y-4">
                        <p class="text-sm text-muted-foreground">
                            {% trans "To unlock advanced features and create more events, please request a plan upgrade. Our team will review your request and contact you shortly." %}
                        </p>

                        <div class="rounded-lg border border-border bg-muted/50 p-4">
                            <h4 class="font-medium mb-2">{% trans "Upgrade Benefits:" %}</h4>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                    <span>{% trans "Unlimited events per month" %}</span>
                                </li>
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                    <span>{% trans "Lower platform fees" %}</span>
                                </li>
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                    <span>{% trans "Advanced analytics" %}</span>
                                </li>
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                    <span>{% trans "Priority support" %}</span>
                                </li>
                            </ul>
                        </div>

                        <div class="flex items-center justify-end gap-3">
                            <button type="button"
                                    data-action="click->modal#close"
                                    class="px-4 py-2 rounded-lg border border-border hover:bg-muted transition-colors">
                                {% trans "Cancel" %}
                            </button>
                            <a href="mailto:support@reckot.com?subject=Plan Upgrade Request"
                               class="px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:opacity-90 transition-opacity">
                                {% trans "Contact Support" %}
                            </a>
                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Contact Information" %} <span class="text-red-500">*</span></label>
                    <p class="text-xs text-muted-foreground mb-3">{% trans "At least one contact method is required" %}</p>
                    <div class="grid gap-4 sm:grid-cols-2">
                        <div>
                            <label for="id_contact_email" class="block text-xs text-muted-foreground mb-1">{% trans "Email" %}</label>
                            <input type="email" name="contact_email" id="id_contact_email" placeholder="contact@event.com"
                                   class="input"
                                   data-action="input->event-form#clearError"
                                   value="{{ event.contact_email|default:'' }}">
                        </div>
                        <div>
                            <label for="id_contact_phone" class="block text-xs text-muted-foreground mb-1">{% trans "Phone" %}</label>
                            <input type="tel" name="contact_phone" id="id_contact_phone" placeholder="6XX XXX XXX"
                                   class="input"
                                   data-action="input->event-form#clearError"
                                   value="{{ event.contact_phone|default:'' }}">
                        </div>
                    </div>
                    <p data-error="contact" class="hidden text-sm text-red-500 mt-2"></p>
                </div>
            </div>
        </div>

        <div data-event-form-target="step5" class="hidden">
            <div class="card p-6 space-y-4">
                <div class="flex items-center gap-3 mb-2">
                    <div class="h-10 w-10 rounded-lg bg-violet-500/10 flex items-center justify-center">
                        <i data-lucide="megaphone" class="h-5 w-5 text-violet-500"></i>
                    </div>
                    <div>
                        <h2 class="text-lg font-semibold">{% trans "Call for proposals" %}</h2>
                        <p class="text-sm text-muted-foreground">{% trans "Accept speaker submissions for your event" %}</p>
                    </div>
                </div>

                <div class="flex items-center justify-between p-4 rounded-lg border border-border">
                    <div class="flex items-center gap-3">
                        <input type="checkbox" name="enable_cfp" id="id_enable_cfp" class="h-4 w-4 rounded border-border"
                               data-action="change->event-form#toggleCfpFields"
                               {% if has_cfp %}checked{% endif %}>
                        <label for="id_enable_cfp" class="text-sm font-medium">{% trans "Enable call for proposals" %}</label>
                    </div>
                    {% if has_cfp %}
                    <a href="{% url 'cfp:cfp_config' event.organization.slug event.slug %}" class="text-xs text-primary hover:underline">{% trans "Advanced settings" %}</a>
                    {% endif %}
                </div>

                <div data-cfp-fields class="{% if not has_cfp %}hidden {% endif %}space-y-4">
                    <div>
                        <label for="id_cfp_title" class="block text-sm font-medium mb-2">{% trans "CFP title" %}</label>
                        <input type="text" name="cfp_title" id="id_cfp_title"
                               placeholder="{% trans "e.g., Call for speakers" %}"
                               class="input" value="{% if has_cfp %}{{ event.cfp.title }}{% else %}{% trans "Call for proposals" %}{% endif %}">
                    </div>

                    <div>
                        <label for="id_cfp_description" class="block text-sm font-medium mb-2">{% trans "Guidelines" %}</label>
                        <textarea name="cfp_description" id="id_cfp_description" rows="3"
                                  placeholder="{% trans "What topics are you looking for? What format?" %}"
                                  class="input">{% if has_cfp %}{{ event.cfp.description }}{% endif %}</textarea>
                    </div>

                    <div class="grid gap-4 sm:grid-cols-2">
                        <div>
                            <label for="id_cfp_opens_at" class="block text-sm font-medium mb-2">{% trans "Opens" %}</label>
                            <div class="relative">
                                <input type="text" name="cfp_opens_at" id="id_cfp_opens_at"
                                       placeholder="{% trans "Select date" %}"
                                       class="input pl-10 cursor-pointer"
                                       data-controller="datepicker"
                                       data-datepicker-enable-time-value="true"
                                       value="{% if has_cfp and event.cfp.opens_at %}{{ event.cfp.opens_at|date:'Y-m-d H:i' }}{% endif %}"
                                       data-action="change->event-form#clearError">
                                <div class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground z-10">
                                    <i data-lucide="calendar-clock" class="w-4 h-4"></i>
                                </div>
                            </div>
                            <p data-error="cfp_opens_at" class="hidden text-sm text-red-500 mt-1"></p>
                        </div>
                        <div>
                            <label for="id_cfp_closes_at" class="block text-sm font-medium mb-2">{% trans "Closes" %}</label>
                            <div class="relative">
                                <input type="text" name="cfp_closes_at" id="id_cfp_closes_at"
                                       placeholder="{% trans "Select date" %}"
                                       class="input pl-10 cursor-pointer"
                                       data-controller="datepicker"
                                       data-datepicker-enable-time-value="true"
                                       value="{% if has_cfp and event.cfp.closes_at %}{{ event.cfp.closes_at|date:'Y-m-d H:i' }}{% endif %}"
                                       data-action="change->event-form#clearError">
                                <div class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground z-10">
                                    <i data-lucide="calendar-clock" class="w-4 h-4"></i>
                                </div>
                            </div>
                            <p data-error="cfp_closes_at" class="hidden text-sm text-red-500 mt-1"></p>
                        </div>
                    </div>

                    <div>
                        <label for="id_cfp_max_submissions" class="block text-sm font-medium mb-2">{% trans "Max submissions per speaker" %}</label>
                        <input type="number" name="cfp_max_submissions" id="id_cfp_max_submissions"
                               value="{% if has_cfp %}{{ event.cfp.max_submissions_per_speaker }}{% else %}3{% endif %}" min="1" max="20" class="input">
                    </div>

                    <p class="text-xs text-muted-foreground">{% trans "You can configure more options (tracks, formats, custom questions) from the CFP management page." %}</p>
                </div>
            </div>
        </div>

    </form>

    <div class="flex items-center justify-between gap-4 mt-6 mb-8">
        <div>
            <button data-prev-button type="button" data-action="click->event-form#prevStep" class="btn btn-outline hidden">
                <i data-lucide="chevron-left" class="w-4 h-4 mr-1"></i>
                <span>{% trans "Back" %}</span>
            </button>
            <a data-cancel-link href="{% url 'events:dashboard' event.organization.slug event.slug %}" class="btn btn-outline">
                <span>{% trans "Cancel" %}</span>
            </a>
        </div>

        <div class="ml-auto">
            <button data-next-button type="button" data-action="click->event-form#nextStep" class="btn btn-default">
                <span>{% trans "Next" %}</span>
                <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
            </button>

            <button data-submit-button type="button" data-action="click->event-form#submitFormButton" class="btn btn-default hidden">
                <span>{% trans "Save changes" %}</span>
                <i data-lucide="check" class="w-4 h-4 ml-1"></i>
            </button>
        </div>
    </div>

    {% if is_owner %}
    <div class="card p-6 border-red-500/20 mt-6" data-controller="modal">
        <h2 class="text-lg font-semibold mb-4 text-red-500">{% trans "Danger Zone" %}</h2>
        <div class="rounded-lg bg-red-500/10 border border-red-500/20 p-4">
            <div class="flex items-start gap-3">
                <i data-lucide="alert-triangle" class="w-5 h-5 shrink-0 mt-0.5 text-red-500"></i>
                <div class="flex-1">
                    <p class="font-medium text-red-500 mb-1">{% trans "Delete Event" %}</p>
                    <p class="text-sm text-red-600 dark:text-red-400 mb-3">
                        {% trans "Permanently delete this event and all its tickets and data. This action cannot be undone." %}
                    </p>
                    <button type="button"
                            data-action="click->modal#open"
                            class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm font-medium">
                        {% trans "Delete Event" %}
                    </button>
                </div>
            </div>
        </div>

        <!-- Delete Modal -->
        <div data-modal-target="container"
             class="hidden fixed inset-0 z-50 overflow-y-auto">
            <div class="flex min-h-screen items-center justify-center p-4">
                <div class="fixed inset-0 bg-black/50 transition-opacity"
                     data-action="click->modal#close"></div>
                <div class="relative bg-card rounded-lg shadow-xl max-w-md w-full p-6 border border-border">
                    <div class="flex items-start gap-4 mb-4">
                        <div class="h-12 w-12 rounded-full bg-red-500/10 flex items-center justify-center shrink-0">
                            <i data-lucide="alert-triangle" class="h-6 w-6 text-red-500"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold mb-1">{% trans "Delete Event" %}</h3>
                            <p class="text-sm text-muted-foreground">
                                {% trans "Are you absolutely sure? This will permanently delete" %} <strong>{{ event.title }}</strong> {% trans "and all its tickets and data. This action cannot be undone." %}
                            </p>
                        </div>
                    </div>
                    <form method="post" action="{% url 'events:delete' org_slug=event.organization.slug event_slug=event.slug %}" class="space-y-4">
                        {% csrf_token %}
                        <div class="flex gap-3 justify-end">
                            <button type="button"
                                    data-action="click->modal#close"
                                    class="px-4 py-2 rounded-lg border border-border hover:bg-muted transition-colors">
                                {% trans "Cancel" %}
                            </button>
                            <button type="submit"
                                    class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors font-medium">
                                {% trans "Delete Event" %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="{% static 'js/richtext.js' %}"></script>
<script src="{% static 'js/ai-assistant.js' %}"></script>
<script src="{% static 'js/event-form-datepicker.js' %}"></script>
<script src="{% static 'js/event-form-edit.js' %}"></script>
{% endblock %}
