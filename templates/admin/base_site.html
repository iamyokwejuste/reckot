{% extends "admin/base.html" %}
{% load static %}

{% block title %}{% if subtitle %}{{ subtitle }} | {% endif %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrahead %}
{{ block.super }}
<script defer src="https://unpkg.com/@alpinejs/collapse@3.14.8/dist/cdn.min.js"></script>
<script defer src="https://unpkg.com/@alpinejs/intersect@3.14.8/dist/cdn.min.js"></script>
<script src="{% static 'js/chatbot.js' %}"></script>
<script defer src="https://unpkg.com/alpinejs@3.14.8/dist/cdn.min.js"></script>
<script defer src="https://unpkg.com/lucide@0.469.0/dist/umd/lucide.min.js" onload="lucide.createIcons()"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const logoLightUrl = '{% static "images/logo/reckto_logo_light_mode.png" %}';
    const logoDarkUrl = '{% static "images/logo/reckto_logo_dark_mode.png" %}';

    const mode = localStorage.getItem('theme') || 'system';
    const isDark = mode === 'dark' || (mode === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
    const logoUrl = isDark ? logoDarkUrl : logoLightUrl;
    const spinnerColor = isDark ? '#fafafa' : '#09090b';

    if (isDark) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }

    const loader = document.createElement('div');
    loader.id = 'page-loader';
    loader.className = 'fixed inset-0 z-[9999] flex items-center justify-center transition-opacity duration-300';
    loader.setAttribute('hx-preserve', 'true');
    loader.style.backgroundColor = isDark ? '#09090b' : '#fafafa';
    loader.innerHTML = `
        <div class="relative w-40 h-40">
            <div class="absolute inset-0 animate-spin rounded-full" style="border: 4px solid rgba(0,0,0,0.1); border-top-color: ${spinnerColor}; color: ${spinnerColor};"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <img src="${logoUrl}" alt="Reckot" class="h-24 w-24 object-contain" loading="eager">
            </div>
        </div>
    `;
    document.body.insertBefore(loader, document.body.firstChild);

    function hideLoader() {
        loader.style.opacity = '0';
        setTimeout(() => loader.style.display = 'none', 300);
    }

    if (document.readyState === 'complete') {
        setTimeout(hideLoader, 800);
    } else {
        window.addEventListener('load', () => {
            setTimeout(hideLoader, 800);
        });
    }
});
</script>
{% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">{{ site_header|default:_('Django administration') }}</a></h1>
{% endblock %}

{% block nav-global %}{% endblock %}

{% block footer %}
{{ block.super }}
{% include "partials/floating_chatbot.html" %}
{% endblock %}
