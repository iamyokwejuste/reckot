{% load i18n %}
{% get_current_language as current_language %}
<div data-controller="dropdown" class="relative">
    <button data-action="click->dropdown#toggle" data-dropdown-target="trigger"
            class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-muted transition-colors text-sm"
            aria-label="{% trans 'Change language' %}"
            aria-haspopup="true">
        <i data-lucide="globe" class="h-4 w-4" aria-hidden="true"></i>
        <span class="hidden md:inline">{{ current_language|upper }}</span>
        <i data-lucide="chevron-down" class="h-3 w-3 text-muted-foreground transition-transform" data-dropdown-target="chevron" aria-hidden="true"></i>
    </button>

    <div data-dropdown-target="menu"
         class="hidden absolute right-0 mt-2 w-40 origin-top-right rounded-lg border border-border bg-card shadow-lg z-50"
         role="menu">
        <div class="p-1">
            <form action="{% url 'set_language' %}" method="post" class="m-0">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.path }}">
                <input type="hidden" name="language" value="en">
                <button type="submit"
                        class="flex items-center gap-3 w-full rounded-md px-3 py-2 text-sm hover:bg-muted transition-colors {% if current_language == 'en' %}bg-muted{% endif %}"
                        role="menuitem">
                    <span class="text-base">EN</span>
                    <span class="flex-1 text-left">English</span>
                    {% if current_language == 'en' %}
                    <i data-lucide="check" class="h-4 w-4 text-foreground" aria-hidden="true"></i>
                    {% endif %}
                </button>
            </form>
            <form action="{% url 'set_language' %}" method="post" class="m-0">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.path }}">
                <input type="hidden" name="language" value="fr">
                <button type="submit"
                        class="flex items-center gap-3 w-full rounded-md px-3 py-2 text-sm hover:bg-muted transition-colors {% if current_language == 'fr' %}bg-muted{% endif %}"
                        role="menuitem">
                    <span class="text-base">FR</span>
                    <span class="flex-1 text-left">Fran√ßais</span>
                    {% if current_language == 'fr' %}
                    <i data-lucide="check" class="h-4 w-4 text-foreground" aria-hidden="true"></i>
                    {% endif %}
                </button>
            </form>
        </div>
    </div>
</div>
