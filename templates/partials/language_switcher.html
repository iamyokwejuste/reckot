{% load i18n %}
<!-- Language Switcher Dropdown -->
<div x-data="{ langOpen: false }" class="relative">
    <button @click="langOpen = !langOpen"
            @click.outside="langOpen = false"
            class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-muted transition-colors text-sm"
            aria-label="{% trans 'Change language' %}"
            aria-haspopup="true"
            :aria-expanded="langOpen.toString()">
        <i data-lucide="globe" class="h-4 w-4" aria-hidden="true"></i>
        <span class="hidden sm:inline">{% if LANGUAGE_CODE == 'fr' %}FR{% else %}EN{% endif %}</span>
        <i data-lucide="chevron-down" class="h-3 w-3 text-muted-foreground transition-transform" :class="langOpen && 'rotate-180'" aria-hidden="true"></i>
    </button>

    <div x-show="langOpen"
         x-transition:enter="transition ease-out duration-100"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="absolute right-0 mt-2 w-40 origin-top-right rounded-lg border border-border bg-card shadow-lg z-50"
         x-cloak
         role="menu">
        <div class="p-1">
            <!-- English -->
            <form action="{% url 'set_language' %}" method="post" class="m-0">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.path }}">
                <input type="hidden" name="language" value="en">
                <button type="submit"
                        class="flex items-center gap-3 w-full rounded-md px-3 py-2 text-sm hover:bg-muted transition-colors {% if LANGUAGE_CODE == 'en' %}bg-muted{% endif %}"
                        role="menuitem">
                    <span class="text-base">EN</span>
                    <span class="flex-1 text-left">English</span>
                    {% if LANGUAGE_CODE == 'en' %}
                    <i data-lucide="check" class="h-4 w-4 text-foreground" aria-hidden="true"></i>
                    {% endif %}
                </button>
            </form>

            <!-- French -->
            <form action="{% url 'set_language' %}" method="post" class="m-0">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.path }}">
                <input type="hidden" name="language" value="fr">
                <button type="submit"
                        class="flex items-center gap-3 w-full rounded-md px-3 py-2 text-sm hover:bg-muted transition-colors {% if LANGUAGE_CODE == 'fr' %}bg-muted{% endif %}"
                        role="menuitem">
                    <span class="text-base">FR</span>
                    <span class="flex-1 text-left">Fran√ßais</span>
                    {% if LANGUAGE_CODE == 'fr' %}
                    <i data-lucide="check" class="h-4 w-4 text-foreground" aria-hidden="true"></i>
                    {% endif %}
                </button>
            </form>
        </div>
    </div>
</div>
