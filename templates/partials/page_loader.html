{% load static %}
<div id="page-loader" class="fixed inset-0 z-[9999] flex items-center justify-center bg-background transition-opacity duration-300" hx-preserve="true">
    <div class="relative w-40 h-40">
        <div id="spinner" class="absolute inset-0 animate-spin rounded-full" style="border: 4px solid rgba(0,0,0,0.1); border-top-color: currentColor;"></div>
        <div class="absolute inset-0 flex items-center justify-center">
            <img id="logo-light" src="{% static 'images/logo/reckto_logo_light_mode.png' %}"
                 alt="Reckot"
                 class="h-24 w-24 object-contain"
                 loading="eager"
                 style="display: none;">
            <img id="logo-dark" src="{% static 'images/logo/reckto_logo_dark_mode.png' %}"
                 alt="Reckot"
                 class="h-24 w-24 object-contain"
                 loading="eager"
                 style="display: none;">
        </div>
    </div>
</div>
<script>
(function() {
    const mode = localStorage.getItem('theme') || 'system';
    const isDark = mode === 'dark' || (mode === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
    const loader = document.getElementById('page-loader');
    const logoLight = document.getElementById('logo-light');
    const logoDark = document.getElementById('logo-dark');
    const spinner = document.getElementById('spinner');

    if (isDark) {
        document.documentElement.classList.add('dark');
        logoDark.style.display = 'block';
        loader.style.backgroundColor = '#09090b';
    } else {
        document.documentElement.classList.remove('dark');
        logoLight.style.display = 'block';
        loader.style.backgroundColor = '#fafafa';
    }

    const spinnerColor = isDark ? '#fafafa' : '#09090b';
    spinner.style.color = spinnerColor;
})();
</script>


<script>
(function() {
    const loader = document.getElementById('page-loader');
    if (!loader) return;

    window.alpineReady = new Promise((resolve, reject) => {
        const timeout = setTimeout(() => {
            console.warn('Alpine initialization timeout - showing page anyway');
            reject(new Error('Alpine timeout'));
        }, 5000);

        document.addEventListener('alpine:init', () => {
            clearTimeout(timeout);
            resolve();
        });
    });

    function hideLoader() {
        loader.style.opacity = '0';
        setTimeout(() => {
            loader.style.display = 'none';
        }, 300);
    }

    window.alpineReady
        .then(() => {
            setTimeout(hideLoader, 300);
        })
        .catch(() => {
            setTimeout(hideLoader, 300);
        });
})();
</script>
