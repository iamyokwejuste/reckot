{% extends "layouts/dashboard.html" %}
{% load static slippers i18n %}

{% block title %}{% trans "Edit" %} {{ organization.name }} - Reckot{% endblock %}

{% block extra_head %}
{% endblock %}

{% block header_title %}
<div class="min-w-0">
    <h1 class="text-lg font-semibold truncate">{% trans "Edit Organization" %}</h1>
    <p class="text-sm text-muted-foreground hidden md:block">{% trans "Update organization details" %}</p>
</div>
{% endblock %}

{% block content %}
<div class="max-w-xl mx-auto" data-controller="toggle">
    <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        <input type="hidden" name="remove_logo" data-toggle-target="removeLogo" value="false">

        {% if error %}
        <div class="rounded-lg bg-red-500/10 border border-red-500/20 p-4 text-sm text-red-500">
            {{ error }}
        </div>
        {% endif %}

        <div class="card p-6 space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">{% trans "Organization Logo" %}</label>
                <div class="flex items-center gap-4">
                    <div class="relative h-16 w-16 rounded-lg bg-muted flex items-center justify-center overflow-hidden cursor-pointer group"
                         data-action="click->toggle#openFileInput">
                        <div data-toggle-target="noLogo" class="{% if organization.logo %}hidden{% endif %}">
                            <i data-lucide="building-2" class="h-8 w-8 text-muted-foreground"></i>
                        </div>
                        <img data-toggle-target="logoPreview" src="{% if organization.logo %}{{ organization.logo.url }}{% endif %}"
                             class="h-full w-full object-cover {% if not organization.logo %}hidden{% endif %}">
                        <div data-toggle-target="logoOverlay"
                             class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity {% if not organization.logo %}hidden{% endif %}">
                            <i data-lucide="pencil" class="h-4 w-4 text-white"></i>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center gap-2">
                            <button type="button" data-action="click->toggle#openFileInput"
                                    class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring border border-border bg-background hover:bg-muted h-8 px-3">
                                <span data-toggle-target="uploadButtonText">{% if organization.logo %}{% trans "Change" %}{% else %}{% trans "Upload" %}{% endif %}</span>
                            </button>
                            <button type="button" data-action="click->toggle#removeLogo"
                                    data-toggle-target="removeButton"
                                    class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring border border-border bg-background hover:bg-red-500/10 h-8 px-3 text-red-500 {% if not organization.logo %}hidden{% endif %}">
                                {% trans "Remove" %}
                            </button>
                        </div>
                        <p class="text-xs text-muted-foreground mt-1">{% trans "PNG, JPG up to 2MB" %}</p>
                    </div>
                </div>
                <input type="file" name="logo" accept="image/*" data-toggle-target="logoInput" data-action="change->toggle#handleLogoChange" class="hidden">
            </div>

            <div>
                <label for="name" class="block text-sm font-medium mb-2">{% trans "Organization Name" %} <span class="text-red-500">*</span></label>
                <input type="text" name="name" id="name" required value="{{ organization.name }}"
                       placeholder="{% trans "e.g., Tech Events Cameroon" %}" class="input">
            </div>

            <div>
                <label for="description" class="block text-sm font-medium mb-2">{% trans "Description" %}</label>
                <textarea name="description" id="description" rows="3"
                          placeholder="{% trans "What does your organization do?" %}" class="hidden"
                          data-richtext>{{ organization.description|safe }}</textarea>
            </div>

            <div>
                <label for="website" class="block text-sm font-medium mb-2">{% trans "Website" %}</label>
                <input type="url" name="website" id="website" value="{{ organization.website }}"
                       placeholder="https://your-organization.com" class="input">
            </div>
        </div>

        <div class="flex items-center gap-4">
            {% #button type="submit" variant="default" %}
                {% trans "Save changes" %}
                <i data-lucide="check" class="w-4 h-4"></i>
            {% /button %}
            <a href="{% url 'orgs:detail' slug=organization.slug %}">{% #button variant="outline" %}{% trans "Cancel" %}{% /button %}</a>
        </div>
    </form>

    {% if is_owner %}
    <div class="card p-6 border-red-500/20" data-controller="modal">
        <h2 class="text-lg font-semibold mb-4 text-red-500">{% trans "Danger Zone" %}</h2>
        <div class="rounded-lg bg-red-500/10 border border-red-500/20 p-4">
            <div class="flex items-start gap-3">
                <i data-lucide="alert-triangle" class="w-5 h-5 shrink-0 mt-0.5 text-red-500"></i>
                <div class="flex-1">
                    <p class="font-medium text-red-500 mb-1">{% trans "Delete Organization" %}</p>
                    <p class="text-sm text-red-600 dark:text-red-400 mb-3">
                        {% trans "Permanently delete this organization and all its events and data. This action cannot be undone." %}
                    </p>
                    <button type="button" data-action="click->modal#open"
                            class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm font-medium">
                        {% trans "Delete Organization" %}
                    </button>
                </div>
            </div>
        </div>

        <div data-modal-target="container" class="fixed inset-0 z-50 overflow-y-auto hidden">
            <div class="flex min-h-screen items-center justify-center p-4">
                <div class="fixed inset-0 bg-black/50 transition-opacity" data-action="click->modal#close"></div>
                <div class="relative bg-card rounded-lg shadow-xl max-w-md w-full p-6 border border-border">
                    <div class="flex items-start gap-4 mb-4">
                        <div class="h-12 w-12 rounded-full bg-red-500/10 flex items-center justify-center shrink-0">
                            <i data-lucide="alert-triangle" class="h-6 w-6 text-red-500"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold mb-1">{% trans "Delete Organization" %}</h3>
                            <p class="text-sm text-muted-foreground">
                                {% trans "Are you absolutely sure? This will permanently delete" %} <strong>{{ organization.name }}</strong> {% trans "and all its events, members, and data. This action cannot be undone." %}
                            </p>
                        </div>
                    </div>
                    <form method="post" action="{% url 'orgs:delete' slug=organization.slug %}" class="space-y-4">
                        {% csrf_token %}
                        <div class="flex gap-3 justify-end">
                            <button type="button" data-action="click->modal#close"
                                    class="px-4 py-2 rounded-lg border border-border hover:bg-muted transition-colors">
                                {% trans "Cancel" %}
                            </button>
                            <button type="submit"
                                    class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors font-medium">
                                {% trans "Delete Organization" %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/richtext.js' %}"></script>
<script src="{% static 'js/image-compress.js' %}"></script>
{% endblock %}
