{% extends "layouts/dashboard.html" %}
{% load slippers i18n %}

{% block title %}{% trans "Session Formats" %} - {{ event.title }} - Reckot{% endblock %}

{% block breadcrumbs %}
{% #breadcrumb class="mb-4" %}
    {% #breadcrumb_item href="/" %}{% trans "Home" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href="/events/" %}{% trans "Events" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item %}{{ event.title|truncatewords:3 }}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item %}{% trans "Session formats" %}{% /breadcrumb_item %}
{% /breadcrumb %}
{% endblock %}

{% block header_title %}
<div class="min-w-0">
    <h1 class="text-lg font-semibold truncate">{% trans "Session Formats" %}</h1>
    <p class="text-sm text-muted-foreground hidden md:block">{{ event.title }}</p>
</div>
{% endblock %}

{% block header_actions %}
<a href="{% url 'cfp:cfp_config' event.organization.slug event.slug %}">
    {% #button variant="ghost" size="sm" %}
        <i data-lucide="arrow-left" class="w-4 h-4"></i>
        <span class="hidden md:inline">{% trans "Back to CFP" %}</span>
    {% /button %}
</a>
{% endblock %}

{% block content %}
<div class="space-y-6">
    {% #card %}
        <div class="flex items-center justify-between mb-6">
            <div>
                <h2 class="text-lg font-semibold">{% trans "Existing formats" %}</h2>
                <p class="text-sm text-muted-foreground">{% trans "Define the types of sessions speakers can propose" %}</p>
            </div>
        </div>

        {% if formats %}
        {% #table %}
            {% #table_header %}
                {% #table_row %}
                    {% #table_head %}{% trans "Name" %}{% /table_head %}
                    {% #table_head %}{% trans "Duration" %}{% /table_head %}
                    {% #table_head %}{% trans "Capacity" %}{% /table_head %}
                    {% #table_head %}{% trans "Active" %}{% /table_head %}
                    {% #table_head class="text-right" %}{% trans "Actions" %}{% /table_head %}
                {% /table_row %}
            {% /table_header %}
            {% #table_body %}
                {% for format in formats %}
                {% #table_row %}
                    {% #table_cell %}
                        <span class="font-medium">{{ format.name }}</span>
                    {% /table_cell %}
                    {% #table_cell %}
                        <span class="text-muted-foreground">{{ format.duration }} {% trans "min" %}</span>
                    {% /table_cell %}
                    {% #table_cell %}
                        {% if format.capacity %}
                        <span class="text-muted-foreground">{{ format.capacity }}</span>
                        {% else %}
                        <span class="text-muted-foreground">-</span>
                        {% endif %}
                    {% /table_cell %}
                    {% #table_cell %}
                        {% if format.is_active %}
                        {% #badge variant="success" %}{% trans "Active" %}{% /badge %}
                        {% else %}
                        {% #badge variant="default" %}{% trans "Inactive" %}{% /badge %}
                        {% endif %}
                    {% /table_cell %}
                    {% #table_cell class="text-right" %}
                        <div class="flex items-center justify-end gap-1">
                            <a href="{% url 'cfp:edit_format' event.organization.slug event.slug format.pk %}">
                                {% #button variant="ghost" size="icon" %}
                                    <i data-lucide="pencil" class="w-4 h-4"></i>
                                {% /button %}
                            </a>
                            <form method="post" action="{% url 'cfp:delete_format' event.organization.slug event.slug format.pk %}" onsubmit="return confirm('{% trans 'Are you sure you want to delete this format?' %}');">
                                {% csrf_token %}
                                {% #button type="submit" variant="ghost" size="icon" class="text-destructive hover:text-destructive" %}
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                {% /button %}
                            </form>
                        </div>
                    {% /table_cell %}
                {% /table_row %}
                {% endfor %}
            {% /table_body %}
        {% /table %}
        {% else %}
        {% #empty_state icon="layout-grid" title=_("No formats yet") description=_("Add your first session format below.") %}{% /empty_state %}
        {% endif %}
    {% /card %}

    {% #card %}
        <h2 class="text-lg font-semibold mb-6">{% trans "Add new format" %}</h2>
        <form method="post" class="space-y-4">
            {% csrf_token %}

            <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
                {% #form_field label=_("Name") name="name" required=True %}
                    {% #input type="text" name="name" id="name" value=form.name.value placeholder=_("e.g. Talk, Workshop, Lightning talk") required=True %}{% /input %}
                    {% if form.name.errors %}
                    <p class="text-sm text-destructive mt-1">{{ form.name.errors.0 }}</p>
                    {% endif %}
                {% /form_field %}

                {% #form_field label=_("Duration (minutes)") name="duration_minutes" required=True %}
                    {% #input type="number" name="duration_minutes" id="duration_minutes" value=form.duration_minutes.value min="5" step="5" placeholder="30" required=True %}{% /input %}
                    {% if form.duration_minutes.errors %}
                    <p class="text-sm text-destructive mt-1">{{ form.duration_minutes.errors.0 }}</p>
                    {% endif %}
                {% /form_field %}

                {% #form_field label=_("Capacity") name="max_capacity" hint=_("Max attendees, leave empty for no limit") %}
                    {% #input type="number" name="max_capacity" id="max_capacity" value=form.max_capacity.value min="1" placeholder="100" %}{% /input %}
                    {% if form.max_capacity.errors %}
                    <p class="text-sm text-destructive mt-1">{{ form.max_capacity.errors.0 }}</p>
                    {% endif %}
                {% /form_field %}

                {% #form_field label=_("Status") name="is_active" %}
                    <label class="flex items-center gap-2 h-12 cursor-pointer">
                        <input type="checkbox" name="is_active" checked class="h-4 w-4 rounded border-border text-primary focus:ring-primary">
                        <span class="text-sm">{% trans "Active" %}</span>
                    </label>
                {% /form_field %}
            </div>

            <div class="flex justify-end">
                {% #button type="submit" variant="default" size="sm" %}
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    {% trans "Add format" %}
                {% /button %}
            </div>
        </form>
    {% /card %}
</div>
{% endblock %}
