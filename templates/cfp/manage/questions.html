{% extends "layouts/dashboard.html" %}
{% load slippers i18n %}

{% block title %}{% trans "Custom Questions" %} - {{ event.title }} - Reckot{% endblock %}

{% block breadcrumbs %}
{% #breadcrumb class="mb-4" %}
    {% #breadcrumb_item href="/" %}{% trans "Home" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href="/events/" %}{% trans "Events" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item %}{{ event.title|truncatewords:3 }}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item %}{% trans "Custom questions" %}{% /breadcrumb_item %}
{% /breadcrumb %}
{% endblock %}

{% block header_title %}
<div class="min-w-0">
    <h1 class="text-lg font-semibold truncate">{% trans "Custom Questions" %}</h1>
    <p class="text-sm text-muted-foreground hidden md:block">{{ event.title }}</p>
</div>
{% endblock %}

{% block header_actions %}
<a href="{% url 'cfp:cfp_config' event.organization.slug event.slug %}">
    {% #button variant="ghost" size="sm" %}
        <i data-lucide="arrow-left" class="w-4 h-4"></i>
        <span class="hidden md:inline">{% trans "Back to CFP" %}</span>
    {% /button %}
</a>
{% endblock %}

{% block content %}
<div class="space-y-6">
    {% #card %}
        <div class="flex items-center justify-between mb-6">
            <div>
                <h2 class="text-lg font-semibold">{% trans "Existing questions" %}</h2>
                <p class="text-sm text-muted-foreground">{% trans "Additional questions speakers must answer when submitting a proposal" %}</p>
            </div>
        </div>

        {% if questions %}
        {% #table %}
            {% #table_header %}
                {% #table_row %}
                    {% #table_head %}{% trans "Question" %}{% /table_head %}
                    {% #table_head %}{% trans "Type" %}{% /table_head %}
                    {% #table_head %}{% trans "Required" %}{% /table_head %}
                    {% #table_head class="text-right" %}{% trans "Actions" %}{% /table_head %}
                {% /table_row %}
            {% /table_header %}
            {% #table_body %}
                {% for question in questions %}
                {% #table_row %}
                    {% #table_cell %}
                        <span class="font-medium">{{ question.text }}</span>
                    {% /table_cell %}
                    {% #table_cell %}
                        {% #badge variant="outline" %}{{ question.get_question_type_display }}{% /badge %}
                    {% /table_cell %}
                    {% #table_cell %}
                        {% if question.is_required %}
                        <span class="flex items-center gap-1 text-sm text-green-600">
                            <i data-lucide="check" class="w-4 h-4"></i>
                            {% trans "Yes" %}
                        </span>
                        {% else %}
                        <span class="flex items-center gap-1 text-sm text-muted-foreground">
                            <i data-lucide="minus" class="w-4 h-4"></i>
                            {% trans "No" %}
                        </span>
                        {% endif %}
                    {% /table_cell %}
                    {% #table_cell class="text-right" %}
                        <div class="flex items-center justify-end gap-1">
                            <a href="{% url 'cfp:edit_question' event.organization.slug event.slug question.pk %}">
                                {% #button variant="ghost" size="icon" %}
                                    <i data-lucide="pencil" class="w-4 h-4"></i>
                                {% /button %}
                            </a>
                            <form method="post" action="{% url 'cfp:delete_question' event.organization.slug event.slug question.pk %}" onsubmit="return confirm('{% trans 'Are you sure you want to delete this question?' %}');">
                                {% csrf_token %}
                                {% #button type="submit" variant="ghost" size="icon" class="text-destructive hover:text-destructive" %}
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                {% /button %}
                            </form>
                        </div>
                    {% /table_cell %}
                {% /table_row %}
                {% endfor %}
            {% /table_body %}
        {% /table %}
        {% else %}
        {% #empty_state icon="help-circle" title=_("No custom questions yet") description=_("Add questions that speakers will answer alongside their proposal.") %}{% /empty_state %}
        {% endif %}
    {% /card %}

    {% #card %}
        <h2 class="text-lg font-semibold mb-6">{% trans "Add new question" %}</h2>
        <form method="post" class="space-y-4">
            {% csrf_token %}

            {% #form_field label=_("Question text") name="text" required=True %}
                {% #input type="text" name="text" id="text" value=form.text.value placeholder=_("e.g. What is your experience with this topic?") required=True %}{% /input %}
                {% if form.text.errors %}
                <p class="text-sm text-destructive mt-1">{{ form.text.errors.0 }}</p>
                {% endif %}
            {% /form_field %}

            <div class="grid gap-4 sm:grid-cols-2">
                {% #form_field label=_("Question type") name="question_type" required=True %}
                    <div class="custom-select-wrapper" data-controller="dropdown" data-dropdown-value-value="{{ form.question_type.value|default:'text' }}" data-action="click@window->dropdown#clickOutside">
                        <input type="hidden" name="question_type" value="{{ form.question_type.value|default:'text' }}" data-dropdown-target="hiddenInput" required>
                        <button type="button" data-dropdown-target="trigger" data-action="click->dropdown#toggle" class="custom-select-trigger">
                            <span class="custom-select-value">{% if form.question_type.value == "textarea" %}{% trans "Long text" %}{% elif form.question_type.value == "select" %}{% trans "Dropdown" %}{% elif form.question_type.value == "checkbox" %}{% trans "Checkbox" %}{% elif form.question_type.value == "radio" %}{% trans "Radio buttons" %}{% elif form.question_type.value == "number" %}{% trans "Number" %}{% elif form.question_type.value == "url" %}{% trans "URL" %}{% else %}{% trans "Short text" %}{% endif %}</span>
                            <i data-lucide="chevron-down" class="custom-select-chevron w-4 h-4"></i>
                        </button>
                        <div data-dropdown-target="dropdown" class="custom-select-dropdown hidden">
                            <div class="custom-select-options">
                                <button type="button" data-dropdown-target="option" data-value="text" data-label="{% trans 'Short text' %}" data-action="click->dropdown#selectOption" class="custom-select-option{% if form.question_type.value == 'text' or not form.question_type.value %} custom-select-option-selected{% endif %}">
                                    <span>{% trans "Short text" %}</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4 {% if form.question_type.value != 'text' and form.question_type.value %}hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="textarea" data-label="{% trans 'Long text' %}" data-action="click->dropdown#selectOption" class="custom-select-option{% if form.question_type.value == 'textarea' %} custom-select-option-selected{% endif %}">
                                    <span>{% trans "Long text" %}</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4 {% if form.question_type.value != 'textarea' %}hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="select" data-label="{% trans 'Dropdown' %}" data-action="click->dropdown#selectOption" class="custom-select-option{% if form.question_type.value == 'select' %} custom-select-option-selected{% endif %}">
                                    <span>{% trans "Dropdown" %}</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4 {% if form.question_type.value != 'select' %}hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="checkbox" data-label="{% trans 'Checkbox' %}" data-action="click->dropdown#selectOption" class="custom-select-option{% if form.question_type.value == 'checkbox' %} custom-select-option-selected{% endif %}">
                                    <span>{% trans "Checkbox" %}</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4 {% if form.question_type.value != 'checkbox' %}hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="radio" data-label="{% trans 'Radio buttons' %}" data-action="click->dropdown#selectOption" class="custom-select-option{% if form.question_type.value == 'radio' %} custom-select-option-selected{% endif %}">
                                    <span>{% trans "Radio buttons" %}</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4 {% if form.question_type.value != 'radio' %}hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="number" data-label="{% trans 'Number' %}" data-action="click->dropdown#selectOption" class="custom-select-option{% if form.question_type.value == 'number' %} custom-select-option-selected{% endif %}">
                                    <span>{% trans "Number" %}</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4 {% if form.question_type.value != 'number' %}hidden{% endif %}"></i>
                                </button>
                                <button type="button" data-dropdown-target="option" data-value="url" data-label="{% trans 'URL' %}" data-action="click->dropdown#selectOption" class="custom-select-option{% if form.question_type.value == 'url' %} custom-select-option-selected{% endif %}">
                                    <span>{% trans "URL" %}</span>
                                    <i data-lucide="check" class="custom-select-check w-4 h-4 {% if form.question_type.value != 'url' %}hidden{% endif %}"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% if form.question_type.errors %}
                    <p class="text-sm text-destructive mt-1">{{ form.question_type.errors.0 }}</p>
                    {% endif %}
                {% /form_field %}

                {% #form_field label=_("Required") name="is_required" %}
                    <label class="flex items-center gap-2 h-12 cursor-pointer">
                        <input type="checkbox" name="is_required" class="h-4 w-4 rounded border-border text-primary focus:ring-primary">
                        <span class="text-sm">{% trans "Speakers must answer this question" %}</span>
                    </label>
                {% /form_field %}
            </div>

            {% #form_field label=_("Options") name="options" hint=_("Comma-separated list of options, only for dropdown, checkbox, and radio types") %}
                {% #input type="text" name="options" id="options" value=form.options.value placeholder=_("e.g. Beginner, Intermediate, Advanced") %}{% /input %}
                {% if form.options.errors %}
                <p class="text-sm text-destructive mt-1">{{ form.options.errors.0 }}</p>
                {% endif %}
            {% /form_field %}

            {% #form_field label=_("Help text") name="help_text" %}
                {% #input type="text" name="help_text" id="help_text" value=form.help_text.value placeholder=_("Additional instructions for the speaker") %}{% /input %}
                {% if form.help_text.errors %}
                <p class="text-sm text-destructive mt-1">{{ form.help_text.errors.0 }}</p>
                {% endif %}
            {% /form_field %}

            <div class="flex justify-end">
                {% #button type="submit" variant="default" size="sm" %}
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    {% trans "Add question" %}
                {% /button %}
            </div>
        </form>
    {% /card %}
</div>
{% endblock %}
