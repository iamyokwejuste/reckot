{% load slippers %}

<div class="custom-select-wrapper"
     data-controller="dropdown"
     data-dropdown-value-value="{{ value|default:'' }}"
     data-dropdown-label-value="{{ label|default:'' }}"
     data-dropdown-placeholder-value="{{ placeholder|default:'Select an option' }}"
     data-action="click@window->dropdown#clickOutside">

    <input type="hidden"
           name="{{ name }}"
           value="{{ value|default:'' }}"
           data-dropdown-target="hiddenInput"
           {% if required %}required{% endif %}>

    <button type="button"
            data-dropdown-target="trigger"
            data-action="click->dropdown#toggle"
            class="custom-select-trigger">
        <span class="custom-select-value">{% firstof label placeholder "Select an option" %}</span>
        <i data-lucide="chevron-down" class="custom-select-chevron w-4 h-4"></i>
    </button>

    <div data-dropdown-target="dropdown"
         class="custom-select-dropdown hidden">

        {% if searchable %}
        <div class="custom-select-search">
            <i data-lucide="search" class="custom-select-search-icon w-3.5 h-3.5"></i>
            <input type="text"
                   data-dropdown-target="search"
                   data-action="input->dropdown#updateSearch click->dropdown#stopPropagation"
                   placeholder="Search..."
                   class="custom-select-search-input">
        </div>
        {% endif %}

        <div class="custom-select-options">
            {% for opt_value, opt_label in options %}
            <button type="button"
                    data-dropdown-target="option"
                    data-value="{{ opt_value }}"
                    data-label="{{ opt_label }}"
                    data-action="click->dropdown#selectOption"
                    class="custom-select-option">
                <span>{{ opt_label }}</span>
                <i data-lucide="check" class="custom-select-check w-4 h-4 {% if value != opt_value %}hidden{% endif %}"></i>
            </button>
            {% empty %}
            <div class="custom-select-empty">No options available</div>
            {% endfor %}
        </div>
    </div>
</div>
