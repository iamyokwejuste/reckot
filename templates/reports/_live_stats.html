{% load i18n  humanize %}
<!-- Live Stats Grid - Updated via HTMX polling -->
<div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
    <div class="stat-card group hover:border-primary/50 transition-colors">
        <div class="flex items-center justify-between">
            <p class="text-sm font-medium text-muted-foreground">{% trans "Total Tickets" %}</p>
            <div class="h-8 w-8 rounded-lg bg-primary/10 flex items-center justify-center">
                <i data-lucide="ticket" class="h-4 w-4 text-primary"></i>
            </div>
        </div>
        <div class="mt-3">
            <p class="text-3xl font-bold">{{ total_tickets }}</p>
            <p class="text-xs text-muted-foreground mt-1">{% trans "Confirmed tickets sold" %}</p>
        </div>
    </div>

    <div class="stat-card group hover:border-emerald-500/50 transition-colors">
        <div class="flex items-center justify-between">
            <p class="text-sm font-medium text-muted-foreground">{% trans "Checked In" %}</p>
            <div class="h-8 w-8 rounded-lg bg-emerald-500/10 flex items-center justify-center">
                <i data-lucide="scan-line" class="h-4 w-4 text-emerald-500"></i>
            </div>
        </div>
        <div class="mt-3">
            <p class="text-3xl font-bold text-emerald-600">{{ checked_in }}</p>
            <div class="flex items-center gap-2 mt-1">
                <div class="flex-1 h-1.5 bg-muted rounded-full overflow-hidden">
                    <div class="h-full bg-emerald-500 rounded-full transition-all duration-500"
                         style="width: {{ check_in_rate|floatformat:0|intcomma }}%"></div>
                </div>
                <span class="text-xs text-muted-foreground">{{ check_in_rate|floatformat:1 }}%</span>
            </div>
        </div>
    </div>

    <div class="stat-card group hover:border-blue-500/50 transition-colors">
        <div class="flex items-center justify-between">
            <p class="text-sm font-medium text-muted-foreground">{% trans "Total Revenue" %}</p>
            <div class="h-8 w-8 rounded-lg bg-blue-500/10 flex items-center justify-center">
                <i data-lucide="banknote" class="h-4 w-4 text-blue-500"></i>
            </div>
        </div>
        <div class="mt-3">
            <p class="text-3xl font-bold text-blue-600">{{ total_revenue|floatformat:0|intcomma }}</p>
            <p class="text-xs text-muted-foreground mt-1">{% trans "XAF confirmed" %}</p>
        </div>
    </div>

    <div class="stat-card group hover:border-amber-500/50 transition-colors">
        <div class="flex items-center justify-between">
            <p class="text-sm font-medium text-muted-foreground">{% trans "Pending" %}</p>
            <div class="h-8 w-8 rounded-lg bg-amber-500/10 flex items-center justify-center">
                <i data-lucide="clock" class="h-4 w-4 text-amber-500"></i>
            </div>
        </div>
        <div class="mt-3">
            <p class="text-3xl font-bold text-amber-600">{{ pending_payments }}</p>
            <p class="text-xs text-muted-foreground mt-1">{% trans "Awaiting payment" %}</p>
        </div>
    </div>
</div>

<!-- Ticket Breakdown -->
{% if ticket_breakdown %}
<div class="mt-6 card p-5">
    <h3 class="font-semibold flex items-center gap-2 mb-4">
        <i data-lucide="pie-chart" class="w-4 h-4"></i>
        {% trans "Ticket Breakdown" %}
    </h3>
    <div class="space-y-3">
        {% for item in ticket_breakdown %}
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="h-3 w-3 rounded-full bg-primary" style="opacity: {% widthratio forloop.counter 10 100 %}%"></div>
                <span class="text-sm">{{ item.ticket_type__name }}</span>
            </div>
            <div class="flex items-center gap-4">
                <div class="w-32 h-2 bg-muted rounded-full overflow-hidden">
                    <div class="h-full bg-primary rounded-full"
                         style="width: {% widthratio item.count total_tickets 100 %}%"></div>
                </div>
                <span class="text-sm font-medium w-12 text-right">{{ item.count }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<script>
    // Re-initialize Lucide icons after HTMX swap
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
</script>
