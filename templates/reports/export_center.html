{% extends "layouts/dashboard.html" %}
{% load slippers %}
{% load i18n %}

{% block title %}{% trans "Export Center" %} - {{ event.title }} - Reckot{% endblock %}

{% block breadcrumbs %}
{% url 'events:dashboard' org_slug=event.organization.slug event_slug=event.slug as event_dashboard_url %}
{% url 'reports:dashboard' org_slug=event.organization.slug event_slug=event.slug as reports_url %}
{% #breadcrumb class="mb-4" %}
    {% #breadcrumb_item href="/" %}{% trans "Home" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href="/events/" %}{% trans "Events" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href=event_dashboard_url %}{{ event.title|truncatewords:3 }}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href=reports_url %}{% trans "Reports" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item %}{% trans "Export Center" %}{% /breadcrumb_item %}
{% /breadcrumb %}
{% endblock %}

{% block header_title %}
<div class="min-w-0">
    <h1 class="text-lg font-semibold truncate">{% trans "Export Center" %}</h1>
    <p class="text-sm text-muted-foreground hidden md:block">{{ event.title }} - {% trans "Generate and download reports" %}</p>
</div>
{% endblock %}

{% block header_actions %}
<a href="{% url 'reports:dashboard' event.organization.slug event.slug %}">
    {% #button variant="outline" size="sm" %}
        <i data-lucide="arrow-left" class="w-4 h-4"></i>
        {% trans "Back to Reports" %}
    {% /button %}
</a>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6" data-controller="toggle">
    <div class="card p-6">
        <h2 class="text-lg font-semibold mb-4">{% trans "Select Report Type" %}</h2>
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
            <button type="button" data-action="click->toggle#select" data-value="FINANCIAL"
                    class="p-4 rounded-lg border-2 text-left transition-all border-border hover:border-muted-foreground"
                    data-toggle-target="option">
                <div class="flex items-center gap-3 mb-2">
                    <div class="h-10 w-10 rounded-lg bg-emerald-500/10 flex items-center justify-center">
                        <i data-lucide="wallet" class="h-5 w-5 text-emerald-500"></i>
                    </div>
                    <span class="font-medium">{% trans "Financial Summary" %}</span>
                </div>
                <p class="text-sm text-muted-foreground">{% trans "Revenue breakdown, payment methods, and ticket sales summary" %}</p>
            </button>

            <button type="button" data-action="click->toggle#select" data-value="RSVP"
                    class="p-4 rounded-lg border-2 text-left transition-all border-border hover:border-muted-foreground"
                    data-toggle-target="option">
                <div class="flex items-center gap-3 mb-2">
                    <div class="h-10 w-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
                        <i data-lucide="users" class="h-5 w-5 text-blue-500"></i>
                    </div>
                    <span class="font-medium">{% trans "Registered Attendees" %}</span>
                </div>
                <p class="text-sm text-muted-foreground">{% trans "List of all registered attendees with contact details" %}</p>
            </button>

            <button type="button" data-action="click->toggle#select" data-value="TICKET_SALES"
                    class="p-4 rounded-lg border-2 text-left transition-all border-border hover:border-muted-foreground"
                    data-toggle-target="option">
                <div class="flex items-center gap-3 mb-2">
                    <div class="h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center">
                        <i data-lucide="ticket" class="h-5 w-5 text-primary"></i>
                    </div>
                    <span class="font-medium">{% trans "Ticket Sales" %}</span>
                </div>
                <p class="text-sm text-muted-foreground">{% trans "Detailed ticket sales with buyer information" %}</p>
            </button>

            <button type="button" data-action="click->toggle#select" data-value="PAYMENTS"
                    class="p-4 rounded-lg border-2 text-left transition-all border-border hover:border-muted-foreground"
                    data-toggle-target="option">
                <div class="flex items-center gap-3 mb-2">
                    <div class="h-10 w-10 rounded-lg bg-amber-500/10 flex items-center justify-center">
                        <i data-lucide="credit-card" class="h-5 w-5 text-amber-500"></i>
                    </div>
                    <span class="font-medium">{% trans "Payment Records" %}</span>
                </div>
                <p class="text-sm text-muted-foreground">{% trans "All payment transactions and their status" %}</p>
            </button>

            <button type="button" data-action="click->toggle#select" data-value="CHECKINS"
                    class="p-4 rounded-lg border-2 text-left transition-all border-border hover:border-muted-foreground"
                    data-toggle-target="option">
                <div class="flex items-center gap-3 mb-2">
                    <div class="h-10 w-10 rounded-lg bg-cyan-500/10 flex items-center justify-center">
                        <i data-lucide="check-circle" class="h-5 w-5 text-cyan-500"></i>
                    </div>
                    <span class="font-medium">{% trans "Check-in Report" %}</span>
                </div>
                <p class="text-sm text-muted-foreground">{% trans "Attendance data with check-in timestamps" %}</p>
            </button>
        </div>
    </div>

    <div class="card p-6 hidden" data-toggle-target="content">
        <h2 class="text-lg font-semibold mb-4">{% trans "Export Format" %}</h2>
        <div class="flex flex-wrap gap-3" data-controller="toggle" data-toggle-initial-value="PDF">
            <button type="button" data-action="click->toggle#select" data-value="PDF"
                    class="px-4 py-2 rounded-lg border-2 font-medium transition-all flex items-center gap-2 border-foreground bg-muted"
                    data-toggle-target="formatOption">
                <i data-lucide="file-text" class="w-4 h-4"></i>
                {% trans "PDF Report" %}
            </button>
            <button type="button" data-action="click->toggle#select" data-value="EXCEL"
                    class="px-4 py-2 rounded-lg border-2 font-medium transition-all flex items-center gap-2 border-border hover:border-muted-foreground"
                    data-toggle-target="formatOption">
                <i data-lucide="table" class="w-4 h-4"></i>
                {% trans "Excel Spreadsheet" %}
            </button>
            <button type="button" data-action="click->toggle#select" data-value="CSV"
                    class="px-4 py-2 rounded-lg border-2 font-medium transition-all flex items-center gap-2 border-border hover:border-muted-foreground"
                    data-toggle-target="formatOption">
                <i data-lucide="file-spreadsheet" class="w-4 h-4"></i>
                {% trans "CSV File" %}
            </button>
            <button type="button" data-action="click->toggle#select" data-value="JSON"
                    class="px-4 py-2 rounded-lg border-2 font-medium transition-all flex items-center gap-2 border-border hover:border-muted-foreground"
                    data-toggle-target="formatOption">
                <i data-lucide="braces" class="w-4 h-4"></i>
                {% trans "JSON Data" %}
            </button>
        </div>

        <div class="mt-6 p-4 rounded-lg bg-muted" data-toggle-target="pdfInfo">
            <div class="flex items-start gap-3">
                <i data-lucide="info" class="w-5 h-5 text-muted-foreground mt-0.5"></i>
                <div>
                    <p class="text-sm font-medium">{% trans "PDF reports include:" %}</p>
                    <ul class="text-sm text-muted-foreground mt-1 space-y-1">
                        <li>{% trans "Cover page with organization logo" %}</li>
                        <li>{% trans "Professional formatting and styling" %}</li>
                        <li>{% trans "Summary statistics and charts" %}</li>
                        <li>{% trans "Page numbers and generation timestamp" %}</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div data-toggle-target="error" class="rounded-lg bg-red-500/10 border border-red-500/20 p-4 text-sm text-red-500 hidden">
    </div>

    <div data-toggle-target="success" class="rounded-lg bg-emerald-500/10 border border-emerald-500/20 p-4 text-sm text-emerald-500 hidden">
    </div>

    <form method="post" action="{% url 'reports:export_generate' event.organization.slug event.slug %}"
          data-toggle-target="form" class="hidden">
        {% csrf_token %}
        <input type="hidden" name="report_type" data-toggle-target="reportTypeInput">
        <input type="hidden" name="format" value="PDF" data-toggle-target="formatInput">

        <div class="flex items-center gap-4">
            {% #button type="submit" variant="default" %}
                <i data-lucide="download" class="w-4 h-4"></i>
                <span>{% trans "Generate & Download" %}</span>
            {% /button %}
            {% #button type="button" variant="outline" attrs='data-action="click->toggle#reset"' %}
                {% trans "Reset Selection" %}
            {% /button %}
        </div>
    </form>

    {% if recent_exports %}
    <div class="card p-6">
        <h2 class="text-lg font-semibold mb-4">{% trans "Recent Exports" %}</h2>
        <div class="space-y-3">
            {% for export in recent_exports %}
            <div class="flex items-center justify-between py-3 border-b border-border last:border-0">
                <div class="flex items-center gap-3">
                    <div class="h-8 w-8 rounded-lg bg-muted flex items-center justify-center">
                        {% if export.format == 'PDF' %}
                        <i data-lucide="file-text" class="h-4 w-4 text-red-500"></i>
                        {% elif export.format == 'EXCEL' %}
                        <i data-lucide="table" class="h-4 w-4 text-green-500"></i>
                        {% else %}
                        <i data-lucide="file-spreadsheet" class="h-4 w-4 text-blue-500"></i>
                        {% endif %}
                    </div>
                    <div>
                        <p class="text-sm font-medium">{{ export.get_report_type_display }}</p>
                        <p class="text-xs text-muted-foreground">{{ export.created_at|date:"M j, Y g:i A" }}</p>
                    </div>
                </div>
                <a href="{% url 'reports:download' export.reference %}">
                    {% #button type="button" variant="outline" size="sm" %}
                        <i data-lucide="download" class="w-4 h-4"></i>
                        {% trans "Download" %}
                    {% /button %}
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
