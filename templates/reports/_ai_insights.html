{% load slippers i18n %}

<div class="card p-5"
     data-controller="ai-insights"
     data-ai-insights-metrics-value="{{ metrics_json|escapejs }}"
     data-ai-insights-analyzing-text-value="{% trans 'Analyzing...' %}"
     data-ai-insights-generate-text-value="{% trans 'Generate Insight' %}"
     data-ai-insights-regenerate-text-value="{% trans 'Regenerate' %}"
     data-ai-insights-error-message-value="{% trans 'Failed to generate insight' %}"
     data-ai-insights-no-result-message-value="{% trans 'No insight generated' %}">
    <div class="flex items-center justify-between mb-4">
        <h3 class="font-semibold flex items-center gap-2">
            <i data-lucide="sparkles" class="w-4 h-4 text-primary"></i>
            {% trans "AI Insights" %}
        </h3>
        <button type="button"
                data-ai-insights-target="btn"
                data-action="click->ai-insights#generateInsight"
                class="btn btn-primary">
            <i data-lucide="wand-2" class="w-4 h-4"></i>
            <span data-ai-insights-target="btnText">{% trans "Generate Insight" %}</span>
        </button>
    </div>

    <div data-ai-insights-target="emptyState" class="text-center py-8">
        <div class="h-16 w-16 mx-auto mb-4 rounded-full bg-primary/10 flex items-center justify-center">
            <i data-lucide="brain" class="w-8 h-8 text-primary"></i>
        </div>
        <p class="text-sm text-muted-foreground mb-2">{% trans "Get AI-powered analysis of your data" %}</p>
        <p class="text-xs text-muted-foreground">{% trans 'Click "Generate Insight" to analyze trends and get actionable recommendations' %}</p>
    </div>

    <div data-ai-insights-target="loadingState" class="text-center py-8 hidden">
        <div class="h-16 w-16 mx-auto mb-4 rounded-full bg-primary/10 flex items-center justify-center">
            <i data-lucide="loader-2" class="w-8 h-8 text-primary animate-spin"></i>
        </div>
        <p class="text-sm font-medium">{% trans "Analyzing your data..." %}</p>
        <p class="text-xs text-muted-foreground mt-1">{% trans "This may take a few seconds" %}</p>
    </div>

    <div data-ai-insights-target="errorState" class="text-center py-6 hidden">
        <div class="h-12 w-12 mx-auto mb-3 rounded-full bg-red-500/10 flex items-center justify-center">
            <i data-lucide="alert-circle" class="w-6 h-6 text-red-500"></i>
        </div>
        <p data-ai-insights-target="errorText" class="text-sm text-red-500 mb-2"></p>
        <button type="button"
                data-action="click->ai-insights#retry"
                class="text-sm text-primary hover:underline">
            {% trans "Try again" %}
        </button>
    </div>

    <div data-ai-insights-target="resultState" class="space-y-4 hidden">
        <div class="p-4 rounded-lg bg-primary/5 border border-primary/10">
            <div class="flex items-start gap-3">
                <div class="h-8 w-8 rounded-lg bg-primary/10 flex items-center justify-center shrink-0 mt-0.5">
                    <i data-lucide="lightbulb" class="w-4 h-4 text-primary"></i>
                </div>
                <div class="flex-1 min-w-0">
                    <p data-ai-insights-target="insightText" class="text-sm leading-relaxed whitespace-pre-wrap break-words"></p>
                </div>
            </div>
        </div>
        <p class="text-xs text-muted-foreground text-center">
            {% trans "Generated by AI based on your current metrics" %}
        </p>
    </div>
</div>
