{% extends "layouts/dashboard.html" %}
{% load slippers i18n %}

{% block title %}{% trans "Custom Responses" %} - {{ event.title }}{% endblock %}

{% block breadcrumbs %}
{% url 'events:dashboard' org_slug=event.organization.slug event_slug=event.slug as event_dashboard_url %}
{% url 'reports:dashboard' org_slug=event.organization.slug event_slug=event.slug as reports_url %}
{% #breadcrumb class="mb-4" %}
    {% #breadcrumb_item href="/" %}{% trans "Home" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href="/events/" %}{% trans "Events" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href=event_dashboard_url %}{{ event.title|truncatewords:3 }}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href=reports_url %}{% trans "Reports" %}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item %}{% trans "Custom Responses" %}{% /breadcrumb_item %}
{% /breadcrumb %}
{% endblock %}

{% block header_title %}
<div class="min-w-0">
    <h1 class="text-lg font-semibold truncate">{% trans "Custom Field Responses" %}</h1>
    <p class="text-sm text-muted-foreground hidden md:block">{{ event.title }}</p>
</div>
{% endblock %}

{% block header_actions %}
<div class="flex gap-2">
    <a href="{% url 'events:checkout_questions' org_slug=event.organization.slug event_slug=event.slug %}">
        {% #button variant="outline" size="sm" %}
            <i data-lucide="settings" class="w-4 h-4 mr-1"></i>
            {% trans "Manage Questions" %}
        {% /button %}
    </a>
    <a href="{% url 'reports:dashboard' org_slug=event.organization.slug event_slug=event.slug %}">
        {% #button variant="outline" size="sm" %}
            <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i>
            {% trans "Back" %}
        {% /button %}
    </a>
</div>
{% endblock %}

{% block content %}
<div class="space-y-6">
    {% if questions_summary %}
    {% for item in questions_summary %}
    <div class="card">
        <div class="p-4 border-b border-border flex justify-between items-center">
            <div>
                <h3 class="font-semibold">{{ item.question.question }}</h3>
                <div class="flex items-center gap-3 mt-1 text-xs text-muted-foreground">
                    <span>{{ item.question.get_field_type_display }}</span>
                    {% if item.question.is_required %}
                    <span class="badge badge-outline">{% trans "Required" %}</span>
                    {% endif %}
                    {% if item.question.per_ticket %}
                    <span class="badge badge-info">{% trans "Per ticket" %}</span>
                    {% endif %}
                </div>
            </div>
            <div class="text-right">
                <div class="text-2xl font-bold">{{ item.answer_count }}</div>
                <div class="text-xs text-muted-foreground">{% trans "responses" %}</div>
            </div>
        </div>

        {% if item.breakdown %}
        <div class="p-4">
            <div class="space-y-3">
                {% for answer, count in item.breakdown.items %}
                <div class="flex items-center gap-3">
                    <div class="flex-1">
                        <div class="flex justify-between text-sm mb-1">
                            <span>{{ answer }}</span>
                            <span class="text-muted-foreground">{{ count }}</span>
                        </div>
                        <div class="w-full bg-muted rounded-full h-2 overflow-hidden">
                            <div class="bg-primary h-full rounded-full transition-all duration-300"
                                 style="width: {% widthratio count item.answer_count 100 %}%"></div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="p-4 text-sm text-muted-foreground">
            <i data-lucide="type" class="w-4 h-4 inline mr-1"></i>
            {% trans "Text responses - view in attendee export" %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
    {% else %}
    <div class="card p-8 text-center">
        <i data-lucide="clipboard-list" class="w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"></i>
        <h3 class="font-semibold mb-2">{% trans "No Custom Questions" %}</h3>
        <p class="text-muted-foreground text-sm mb-4">{% trans "Add custom questions to collect additional info from attendees" %}</p>
        <a href="{% url 'events:checkout_questions' org_slug=event.organization.slug event_slug=event.slug %}">
            {% #button variant="default" size="sm" %}
                <i data-lucide="plus" class="w-4 h-4 mr-1"></i>
                {% trans "Add Questions" %}
            {% /button %}
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
