{% extends "layouts/dashboard.html" %}
{% load slippers %}

{% block title %}Scan Tickets - {{ event.title }} - Reckot{% endblock %}

{% block breadcrumbs %}
{% url 'events:dashboard' org_slug=event.organization.slug event_slug=event.slug as event_dashboard_url %}
{% url 'checkin:dashboard' org_slug=event.organization.slug event_slug=event.slug as checkin_dashboard_url %}
{% #breadcrumb class="mb-4" %}
    {% #breadcrumb_item href="/" %}Home{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href="/events/" %}Events{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href=event_dashboard_url %}{{ event.title|truncatewords:3 }}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href=checkin_dashboard_url %}Check-in{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item %}Scanner{% /breadcrumb_item %}
{% /breadcrumb %}
{% endblock %}

{% block header_title %}
<div>
    <h1 class="text-lg font-semibold">{{ event.title }}</h1>
    <p class="text-sm text-muted-foreground">Scan or search for tickets</p>
</div>
{% endblock %}

{% block header_actions %}
<a href="{% url 'checkin:dashboard' org_slug=event.organization.slug event_slug=event.slug %}">
    {% #button variant="outline" size="sm" %}
        <i data-lucide="arrow-left" class="mr-2 h-4 w-4"></i>
        Back to Dashboard
    {% /button %}
</a>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="grid gap-6 lg:grid-cols-2">
        <div>
            <div data-animate="fade-up" data-delay="0.1">
                {% #card %}
                    <h2 class="text-lg font-semibold">Manual Check-in</h2>
                    <p class="text-sm text-muted-foreground mb-4">Enter ticket code or scan QR</p>

                    <form
                        hx-post="{% url 'checkin:verify' org_slug=event.organization.slug event_slug=event.slug %}"
                        hx-target="#checkin-result"
                        hx-swap="innerHTML"
                        class="space-y-4"
                    >
                        {% csrf_token %}
                        <div class="space-y-2">
                            <label for="code" class="block text-sm font-medium">Ticket Code</label>
                            <input type="text" name="code" id="code"
                                   placeholder="Enter ticket code or UUID" required
                                   class="input w-full font-mono">
                        </div>
                        {% #button type="submit" variant="default" class="w-full" %}
                            <i data-lucide="check" class="mr-2 h-4 w-4"></i>
                            Check In
                        {% /button %}
                    </form>

                    <div id="checkin-result" class="mt-6"></div>
                {% /card %}
            </div>

            <div class="mt-6 grid grid-cols-3 gap-4" data-stagger>
                {% #card class="text-center" %}
                    <p class="text-3xl font-bold">{{ stats.total }}</p>
                    <p class="text-sm text-muted-foreground">Total</p>
                {% /card %}
                {% #card class="text-center" %}
                    <p class="text-3xl font-bold text-success">{{ stats.checked_in }}</p>
                    <p class="text-sm text-muted-foreground">Checked In</p>
                {% /card %}
                {% #card class="text-center" %}
                    <p class="text-3xl font-bold text-warning">{{ stats.remaining }}</p>
                    <p class="text-sm text-muted-foreground">Remaining</p>
                {% /card %}
            </div>
        </div>

        <div data-animate="fade-up" data-delay="0.2">
            {% #card %}
                <h2 class="text-lg font-semibold">Search Attendees</h2>
                <p class="text-sm text-muted-foreground mb-4">Find by name or email</p>

                <input
                    type="search"
                    name="q"
                    placeholder="Search by name, email, or code..."
                    class="input w-full"
                    hx-get="{% url 'checkin:search' org_slug=event.organization.slug event_slug=event.slug %}"
                    hx-trigger="keyup changed delay:300ms"
                    hx-target="#search-results"
                >

                <div id="search-results" class="mt-4"></div>
            {% /card %}
        </div>
    </div>
</div>
{% endblock %}
