{% extends "layouts/dashboard.html" %}
{% load slippers %}

{% block title %}Check-in - {{ event.title }} - Reckot{% endblock %}

{% block breadcrumbs %}
{% url 'events:dashboard' org_slug=event.organization.slug event_slug=event.slug as event_dashboard_url %}
{% #breadcrumb class="mb-4" %}
    {% #breadcrumb_item href="/" %}Home{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item href="/events/" %}Events{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item :href="event_dashboard_url" %}{{ event.title|truncatewords:3 }}{% /breadcrumb_item %}
    {% #breadcrumb_separator %}{% /breadcrumb_separator %}
    {% #breadcrumb_item %}Check-in{% /breadcrumb_item %}
{% /breadcrumb %}
{% endblock %}

{% block header_title %}
<div>
    <h1 class="text-lg font-semibold">{{ event.title }}</h1>
    <p class="text-sm text-muted-foreground">Check-in Dashboard</p>
</div>
{% endblock %}

{% block header_actions %}
<a href="{% url 'checkin:verify' org_slug=event.organization.slug event_slug=event.slug %}">
    {% #button variant="default" size="sm" %}
        <i data-lucide="scan" class="mr-2 h-4 w-4"></i>
        Scan Tickets
    {% /button %}
</a>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <div id="stats-panel" hx-get="{% url 'checkin:stats' org_slug=event.organization.slug event_slug=event.slug %}" hx-trigger="every 10s">
        {% include "checkin/_stats.html" %}
    </div>

    <div class="grid gap-6 lg:grid-cols-2">
        <div data-animate="fade-up" data-delay="0.1">
            {% #card %}
                <h2 class="text-lg font-semibold mb-4">Recent Check-ins</h2>
                {% if recent_checkins %}
                <div class="space-y-3">
                    {% for checkin in recent_checkins %}
                    <div class="flex items-center justify-between rounded-xl border border-border p-4 hover:bg-accent/50 transition-colors">
                        <div class="flex items-center gap-3">
                            {% #avatar initials=checkin.ticket.booking.user.email|slice:":2"|upper size="sm" %}{% /avatar %}
                            <div>
                                <p class="font-medium">{{ checkin.ticket.booking.user.email }}</p>
                                <p class="text-xs text-muted-foreground">{{ checkin.ticket.ticket_type.name }}</p>
                            </div>
                        </div>
                        <span class="text-xs text-muted-foreground">{{ checkin.checked_in_at|timesince }} ago</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                {% #empty_state icon="users" title="No check-ins yet" description="Start scanning tickets to see check-ins here." %}{% /empty_state %}
                {% endif %}
            {% /card %}
        </div>

        <div data-animate="fade-up" data-delay="0.2">
            {% #card %}
                <h2 class="text-lg font-semibold mb-4">Swag Items</h2>
                {% if swag_items %}
                <div class="space-y-3">
                    {% for item in swag_items %}
                    <div class="flex items-center justify-between rounded-xl border border-border p-4 hover:bg-accent/50 transition-colors">
                        <div>
                            <p class="font-medium">{{ item.name }}</p>
                            <p class="text-xs text-muted-foreground">{{ item.description }}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold">{{ item.remaining }}/{{ item.quantity }}</p>
                            <p class="text-xs text-muted-foreground">remaining</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                {% #empty_state icon="gift" title="No swag items" description="Add swag items for this event." %}{% /empty_state %}
                {% endif %}
            {% /card %}
        </div>
    </div>
</div>
{% endblock %}
