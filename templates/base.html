{% load static %}
{% load slippers %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en" class="h-full" x-data="themeHandler()" :class="{ 'dark': isDark }">
<head>
    <meta charset="UTF-8">
    <script>
        (function() {
            var mode = localStorage.getItem('theme') || 'system';
            var isDark = mode === 'dark' || (mode === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
            if (isDark) document.documentElement.classList.add('dark');
        })();
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block meta_description %}Reckot - Modern event management platform for Africa. Create, manage, and sell tickets for your events with ease.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}event management, ticketing, events, Africa, Cameroon, conferences, concerts, workshops, event planning, ticket sales, event registration{% endblock %}">
    <meta name="theme-color" content="#09090b">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Reckot">
    <meta name="generator" content="Reckot Platform">
    <meta name="application-name" content="Reckot">
    <title>{% block title %}Reckot - Event Management Platform{% endblock %}</title>

    <link rel="canonical" href="{{ request.build_absolute_uri }}">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:title" content="{% block og_title %}Reckot - Event Management Platform{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Modern event management platform for Africa. Create, manage, and sell tickets for your events with ease.{% endblock %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:site_name" content="Reckot">
    <meta property="og:locale" content="en_US">
    {% block og_image %}<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'images/reckot_preview.png' %}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Reckot - You got better things to do with your time!">{% endblock %}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@raboreckot">
    <meta name="twitter:creator" content="@raboreckot">
    <meta name="twitter:title" content="{% block twitter_title %}Reckot - Event Management Platform{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}Modern event management platform for Africa. Create, manage, and sell tickets for your events with ease.{% endblock %}">
    {% block twitter_image %}<meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'images/reckot_preview.png' %}">
    <meta name="twitter:image:alt" content="Reckot - You got better things to do with your time!">{% endblock %}

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="dns-prefetch" href="https://unpkg.com">
    <link rel="preload" href="{% static 'css/output.css' %}" as="style" fetchpriority="high">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>

    <link href="{% static 'css/output.css' %}" rel="stylesheet">

    <script>
        function themeHandler() {
            return {
                isDark: document.documentElement.classList.contains('dark'),
                mode: localStorage.getItem('theme') || 'system',
                init() {
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                        if (this.mode === 'system') this.updateTheme();
                    });
                },
                updateTheme() {
                    if (this.mode === 'system') {
                        this.isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    } else {
                        this.isDark = this.mode === 'dark';
                    }
                },
                setMode(m) {
                    this.mode = m;
                    localStorage.setItem('theme', m);
                    this.updateTheme();
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        [x-cloak] { display: none !important; }
    </style>

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Reckot",
        "description": "Modern event management platform for Africa. Create, manage, and sell tickets for your events with ease.",
        "url": "{{ request.scheme }}://{{ request.get_host }}",
        "logo": "{{ request.scheme }}://{{ request.get_host }}{% static 'images/logo/logo_light_mode.png' %}"
    }
    </script>
    {% block structured_data %}{% endblock %}

    {% block extra_head %}{% endblock %}
</head>
<body class="min-h-screen bg-background text-foreground antialiased flex flex-col transition-colors duration-300" hx-boost="true">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[100] focus:px-4 focus:py-2 focus:bg-foreground focus:text-background focus:rounded-lg">Skip to main content</a>
    {% include "partials/messages.html" %}
    {% include "partials/navigation.html" %}
    <main id="main-content" class="flex-1 pt-6 pb-16" role="main">{% block content %}{% endblock %}</main>
    <footer class="border-t border-border py-8 sm:py-12 mt-auto" role="contentinfo">
        <div class="container">
            <div class="grid grid-cols-2 gap-6 sm:gap-8 md:grid-cols-4">
                <div class="col-span-2 md:col-span-1 mb-2 md:mb-0">
                    <a href="/" class="inline-block" aria-label="Reckot Home">
                        <img x-show="!isDark" src="{% static 'images/logo/logo_light_mode.png' %}" alt="Reckot" width="120" height="32" class="h-7 sm:h-8 w-auto" loading="lazy">
                        <img x-show="isDark" x-cloak src="{% static 'images/logo/logo_dark_mode.png' %}" alt="Reckot" width="120" height="32" class="h-7 sm:h-8 w-auto" loading="lazy">
                    </a>
                    <p class="mt-3 text-xs sm:text-sm text-muted-foreground">{% trans "Modern event management for Africa." %}</p>
                </div>
                <div>
                    <h2 class="font-medium text-sm mb-3">{% trans "Product" %}</h2>
                    <ul class="space-y-2 text-xs sm:text-sm text-muted-foreground">
                        <li><a href="{% url 'features' %}" class="hover:text-foreground transition-colors">{% trans "Features" %}</a></li>
                        <li><a href="{% url 'home' %}#pricing" class="hover:text-foreground transition-colors">{% trans "Pricing" %}</a></li>
                        <li><a href="{% url 'why_us' %}" class="hover:text-foreground transition-colors">{% trans "Why Us" %}</a></li>
                    </ul>
                </div>
                <div>
                    <h2 class="font-medium text-sm mb-3">{% trans "Company" %}</h2>
                    <ul class="space-y-2 text-xs sm:text-sm text-muted-foreground">
                        <li><a href="https://yokwejuste.me" target="_blank" rel="noopener noreferrer" class="hover:text-foreground transition-colors">{% trans "About" %}</a></li>
                    </ul>
                </div>
                <div>
                    <h2 class="font-medium text-sm mb-3">{% trans "Legal" %}</h2>
                    <ul class="space-y-2 text-xs sm:text-sm text-muted-foreground">
                        <li><a href="{% url 'privacy' %}" class="hover:text-foreground transition-colors">{% trans "Privacy" %}</a></li>
                        <li><a href="{% url 'terms' %}" class="hover:text-foreground transition-colors">{% trans "Terms" %}</a></li>
                    </ul>
                </div>
            </div>
            <div class="mt-6 pt-6 border-t border-border">
                <p class="text-xs sm:text-sm text-muted-foreground text-center md:text-left">&copy; {% now "Y" %} Reckot. {% trans "All rights reserved." %}</p>
            </div>
        </div>
    </footer>

    <script defer src="https://unpkg.com/htmx.org@1.9.12/dist/htmx.min.js"></script>
    <script defer src="https://unpkg.com/@alpinejs/collapse@3.14.8/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/@alpinejs/intersect@3.14.8/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.14.8/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/lucide@0.469.0/dist/umd/lucide.min.js" onload="lucide.createIcons()"></script>
    <script defer src="{% static 'js/offline.js' %}"></script>

    <script>
        document.addEventListener("htmx:afterSwap", () => {
            if (typeof lucide !== 'undefined') lucide.createIcons();
        });

        // Handle toast messages from HTMX responses via HX-Trigger header
        document.addEventListener("showToast", (e) => {
            const { type, message } = e.detail;
            showToast(type, message);
        });

        // Global toast function for programmatic use
        window.showToast = function(type, message) {
            const container = document.getElementById('toast-container') || createToastContainer();
            const toast = document.createElement('div');
            toast.className = `pointer-events-auto rounded-lg border shadow-lg p-4 flex items-start gap-3 transition-all duration-300 transform translate-x-4 opacity-0`;

            const colors = {
                success: 'bg-emerald-500/10 border-emerald-500/20 text-emerald-700 dark:text-emerald-400',
                warning: 'bg-amber-500/10 border-amber-500/20 text-amber-700 dark:text-amber-400',
                error: 'bg-red-500/10 border-red-500/20 text-red-700 dark:text-red-400',
                info: 'bg-card border-border'
            };
            const icons = {
                success: 'check-circle',
                warning: 'alert-triangle',
                error: 'x-circle',
                info: 'info'
            };

            toast.classList.add(...(colors[type] || colors.info).split(' '));
            toast.innerHTML = `
                <i data-lucide="${icons[type] || icons.info}" class="h-5 w-5 shrink-0 mt-0.5"></i>
                <p class="text-sm flex-1">${message}</p>
                <button onclick="this.parentElement.remove()" class="shrink-0 -mr-1 -mt-1 p-1 rounded hover:bg-black/5 dark:hover:bg-white/10">
                    <i data-lucide="x" class="h-4 w-4"></i>
                </button>
            `;

            container.appendChild(toast);
            if (typeof lucide !== 'undefined') lucide.createIcons();

            requestAnimationFrame(() => {
                toast.classList.remove('translate-x-4', 'opacity-0');
            });

            setTimeout(() => {
                toast.classList.add('translate-x-4', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        };

        function createToastContainer() {
            const container = document.createElement('div');
            container.id = 'toast-container';
            container.className = 'fixed bottom-4 right-4 z-[100] flex flex-col gap-2 max-w-sm w-full pointer-events-none';
            document.body.appendChild(container);
            return container;
        }
    </script>

    {% block extra_scripts %}{% endblock %}

    <a href="{% url 'ai:assistant' %}"
       class="fixed bottom-20 right-6 z-[60] flex h-14 w-14 items-center justify-center rounded-full bg-primary text-primary-foreground shadow-xl hover:scale-110 hover:shadow-2xl transition-all duration-200 group animate-pulse-slow"
       title="{% trans 'AI Assistant' %}">
        <i data-lucide="bot" class="h-6 w-6"></i>
        <span class="absolute right-full mr-3 whitespace-nowrap rounded-lg bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-lg opacity-0 group-hover:opacity-100 transition-opacity">
            {% trans "AI Assistant" %}
        </span>
        <span class="absolute -top-1 -right-1 flex h-4 w-4">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-4 w-4 bg-emerald-500"></span>
        </span>
    </a>
    <style>
        @keyframes pulse-slow { 0%, 100% { opacity: 1; } 50% { opacity: 0.9; } }
        .animate-pulse-slow { animation: pulse-slow 3s infinite; }
    </style>
</body>
</html>
