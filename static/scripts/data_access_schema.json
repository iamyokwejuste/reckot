{
  "schema_version": "1.0.0",
  "description": "Data access schema for AI governance - defines which tables and columns can be accessed by AI queries",
  "last_updated": "2026-02-04",

  "access_levels": {
    "PUBLIC": "Anonymous users - can query public event information",
    "AUTHENTICATED": "Logged-in users - can query their own data + public data",
    "ORG_MEMBER": "Organization members - can query org data + their own data + public data",
    "ADMIN": "Admins only - not for AI queries",
    "BLOCKED": "Never accessible via AI queries"
  },

  "tables": {
    "events_event": {
      "description": "Event information",
      "access_level": "PUBLIC",
      "row_filter": "is_public = TRUE AND state = 'PUBLISHED'",
      "columns": {
        "id": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "organization_id": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "category_id": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "title": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "slug": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "description": {"type": "text", "access": "PUBLIC", "sensitive": false},
        "short_description": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "cover_image": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "start_at": {"type": "datetime", "access": "PUBLIC", "sensitive": false},
        "end_at": {"type": "datetime", "access": "PUBLIC", "sensitive": false},
        "timezone": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "event_type": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "location": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "venue_name": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "address_line_2": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "city": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "country": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "online_url": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "website": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "capacity": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "state": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "is_public": {"type": "boolean", "access": "PUBLIC", "sensitive": false},
        "is_free": {"type": "boolean", "access": "PUBLIC", "sensitive": false},
        "is_featured": {"type": "boolean", "access": "PUBLIC", "sensitive": false},
        "created_at": {"type": "datetime", "access": "PUBLIC", "sensitive": false},
        "updated_at": {"type": "datetime", "access": "PUBLIC", "sensitive": false},

        "contact_email": {"type": "string", "access": "ORG_MEMBER", "sensitive": true},
        "contact_phone": {"type": "string", "access": "ORG_MEMBER", "sensitive": true},
        "preview_token": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "ticket_prefix": {"type": "string", "access": "BLOCKED", "sensitive": false},
        "feature_requested_at": {"type": "datetime", "access": "BLOCKED", "sensitive": false},
        "feature_approved_at": {"type": "datetime", "access": "BLOCKED", "sensitive": false},
        "feature_expires_at": {"type": "datetime", "access": "BLOCKED", "sensitive": false},
        "feature_order": {"type": "integer", "access": "BLOCKED", "sensitive": false},
        "feature_rejection_reason": {"type": "text", "access": "BLOCKED", "sensitive": false}
      }
    },

    "events_eventcategory": {
      "description": "Event categories",
      "access_level": "PUBLIC",
      "row_filter": "is_active = TRUE",
      "columns": {
        "id": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "name": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "slug": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "description": {"type": "text", "access": "PUBLIC", "sensitive": false},
        "icon": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "color": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "is_active": {"type": "boolean", "access": "PUBLIC", "sensitive": false},
        "display_order": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "created_at": {"type": "datetime", "access": "PUBLIC", "sensitive": false},
        "updated_at": {"type": "datetime", "access": "PUBLIC", "sensitive": false}
      }
    },

    "tickets_tickettype": {
      "description": "Ticket types and pricing",
      "access_level": "PUBLIC",
      "row_filter": "is_active = TRUE AND event_id IN (SELECT id FROM events_event WHERE is_public = TRUE)",
      "columns": {
        "id": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "event_id": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "name": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "price": {"type": "decimal", "access": "PUBLIC", "sensitive": false},
        "quantity": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "description": {"type": "text", "access": "PUBLIC", "sensitive": false},
        "max_per_order": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "sales_start": {"type": "datetime", "access": "PUBLIC", "sensitive": false},
        "sales_end": {"type": "datetime", "access": "PUBLIC", "sensitive": false},
        "is_active": {"type": "boolean", "access": "PUBLIC", "sensitive": false}
      }
    },

    "orgs_organization": {
      "description": "Organizations (limited public info)",
      "access_level": "PUBLIC",
      "row_filter": null,
      "columns": {
        "id": {"type": "integer", "access": "PUBLIC", "sensitive": false},
        "name": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "slug": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "description": {"type": "text", "access": "PUBLIC", "sensitive": false},
        "logo": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "website": {"type": "string", "access": "PUBLIC", "sensitive": false},
        "created_at": {"type": "datetime", "access": "PUBLIC", "sensitive": false},

        "currency": {"type": "string", "access": "ORG_MEMBER", "sensitive": false},
        "owner_id": {"type": "integer", "access": "BLOCKED", "sensitive": false},
        "updated_at": {"type": "datetime", "access": "BLOCKED", "sensitive": false}
      }
    },

    "tickets_booking": {
      "description": "Ticket bookings - user's own data only",
      "access_level": "AUTHENTICATED",
      "row_filter": "user_id = :current_user_id OR booking_id IN (SELECT id FROM user_org_bookings)",
      "columns": {
        "id": {"type": "uuid", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "reference": {"type": "uuid", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "event_id": {"type": "integer", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "user_id": {"type": "integer", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "status": {"type": "string", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "delivery_method": {"type": "string", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "total_amount": {"type": "decimal", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true, "aggregation_only_for_public": true},
        "created_at": {"type": "datetime", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "updated_at": {"type": "datetime", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},

        "guest_session_id": {"type": "integer", "access": "BLOCKED", "sensitive": true},
        "guest_email": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "guest_name": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "guest_phone": {"type": "string", "access": "BLOCKED", "sensitive": true}
      }
    },

    "tickets_ticket": {
      "description": "Individual tickets - user's own only",
      "access_level": "AUTHENTICATED",
      "row_filter": "booking_id IN (SELECT id FROM tickets_booking WHERE user_id = :current_user_id)",
      "columns": {
        "id": {"type": "integer", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "booking_id": {"type": "integer", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "ticket_type_id": {"type": "integer", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "code": {"type": "string", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "is_checked_in": {"type": "boolean", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "checked_in_at": {"type": "datetime", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},

        "attendee_name": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "attendee_email": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "checked_in_by_id": {"type": "integer", "access": "BLOCKED", "sensitive": false}
      }
    },

    "payments_payment": {
      "description": "Payment records - aggregated data only for PUBLIC",
      "access_level": "ORG_MEMBER",
      "row_filter": "booking_id IN (SELECT id FROM org_bookings)",
      "columns": {
        "id": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "booking_id": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "reference": {"type": "uuid", "access": "ORG_MEMBER", "sensitive": false},
        "amount": {"type": "decimal", "access": "ORG_MEMBER", "sensitive": false, "aggregation_only": true},
        "service_fee": {"type": "decimal", "access": "ORG_MEMBER", "sensitive": false, "aggregation_only": true},
        "currency": {"type": "string", "access": "ORG_MEMBER", "sensitive": false},
        "provider": {"type": "string", "access": "ORG_MEMBER", "sensitive": false},
        "status": {"type": "string", "access": "AUTHENTICATED", "sensitive": false, "requires_ownership": true},
        "created_at": {"type": "datetime", "access": "ORG_MEMBER", "sensitive": false},
        "confirmed_at": {"type": "datetime", "access": "ORG_MEMBER", "sensitive": false},

        "phone_number": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "customer_email": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "external_reference": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "redirect_url": {"type": "string", "access": "BLOCKED", "sensitive": false},
        "gateway_config_id": {"type": "integer", "access": "BLOCKED", "sensitive": false},
        "metadata": {"type": "json", "access": "BLOCKED", "sensitive": true},
        "expires_at": {"type": "datetime", "access": "BLOCKED", "sensitive": false}
      }
    },

    "core_user": {
      "description": "User accounts - COUNT ONLY, no personal data",
      "access_level": "BLOCKED",
      "row_filter": null,
      "columns": {
        "id": {"type": "integer", "access": "BLOCKED", "sensitive": true, "aggregation_only": true, "allowed_aggregations": ["COUNT"]},
        "username": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "email": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "password": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "first_name": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "last_name": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "phone_number": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "email_verified": {"type": "boolean", "access": "BLOCKED", "sensitive": false},
        "phone_verified": {"type": "boolean", "access": "BLOCKED", "sensitive": false},
        "ai_features_enabled": {"type": "boolean", "access": "BLOCKED", "sensitive": false},
        "profile_image": {"type": "string", "access": "BLOCKED", "sensitive": false},
        "social_avatar_url": {"type": "string", "access": "BLOCKED", "sensitive": false},
        "is_active": {"type": "boolean", "access": "BLOCKED", "sensitive": false},
        "is_staff": {"type": "boolean", "access": "BLOCKED", "sensitive": true},
        "is_superuser": {"type": "boolean", "access": "BLOCKED", "sensitive": true},
        "date_joined": {"type": "datetime", "access": "BLOCKED", "sensitive": false},
        "last_login": {"type": "datetime", "access": "BLOCKED", "sensitive": false}
      }
    },

    "analytics_eventmetrics": {
      "description": "Event analytics - org members only",
      "access_level": "ORG_MEMBER",
      "row_filter": "event_id IN (SELECT id FROM org_events)",
      "columns": {
        "id": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "event_id": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "total_revenue": {"type": "decimal", "access": "ORG_MEMBER", "sensitive": false},
        "platform_fees": {"type": "decimal", "access": "ORG_MEMBER", "sensitive": false},
        "net_revenue": {"type": "decimal", "access": "ORG_MEMBER", "sensitive": false},
        "tickets_sold": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "tickets_checked_in": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "orders_count": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "conversion_rate": {"type": "decimal", "access": "ORG_MEMBER", "sensitive": false},
        "page_views": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "unique_visitors": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "last_updated": {"type": "datetime", "access": "ORG_MEMBER", "sensitive": false}
      }
    },

    "analytics_organizationmetrics": {
      "description": "Organization analytics - org members only",
      "access_level": "ORG_MEMBER",
      "row_filter": "organization_id IN (SELECT id FROM user_organizations)",
      "columns": {
        "id": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "organization_id": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "total_revenue": {"type": "decimal", "access": "ORG_MEMBER", "sensitive": false},
        "total_fees_paid": {"type": "decimal", "access": "ORG_MEMBER", "sensitive": false},
        "net_revenue": {"type": "decimal", "access": "ORG_MEMBER", "sensitive": false},
        "total_tickets_sold": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "total_events": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "active_events": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "completed_events": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "total_attendees": {"type": "integer", "access": "ORG_MEMBER", "sensitive": false},
        "average_ticket_price": {"type": "decimal", "access": "ORG_MEMBER", "sensitive": false},
        "last_updated": {"type": "datetime", "access": "ORG_MEMBER", "sensitive": false}
      }
    },

    "payments_paymentgatewayconfig": {
      "description": "Payment gateway credentials - NEVER accessible",
      "access_level": "BLOCKED",
      "row_filter": null,
      "columns": {
        "id": {"type": "integer", "access": "BLOCKED", "sensitive": true},
        "organization_id": {"type": "integer", "access": "BLOCKED", "sensitive": false},
        "provider": {"type": "string", "access": "BLOCKED", "sensitive": false},
        "is_active": {"type": "boolean", "access": "BLOCKED", "sensitive": false},
        "is_default": {"type": "boolean", "access": "BLOCKED", "sensitive": false},
        "credentials": {"type": "json", "access": "BLOCKED", "sensitive": true},
        "supported_currencies": {"type": "json", "access": "BLOCKED", "sensitive": false},
        "service_fee_type": {"type": "string", "access": "BLOCKED", "sensitive": false},
        "service_fee_fixed": {"type": "decimal", "access": "BLOCKED", "sensitive": false},
        "service_fee_percentage": {"type": "decimal", "access": "BLOCKED", "sensitive": false}
      }
    },

    "payments_withdrawal": {
      "description": "Withdrawal requests - NEVER accessible via AI",
      "access_level": "BLOCKED",
      "row_filter": null,
      "columns": {
        "id": {"type": "integer", "access": "BLOCKED", "sensitive": true},
        "organization_id": {"type": "integer", "access": "BLOCKED", "sensitive": false},
        "reference": {"type": "uuid", "access": "BLOCKED", "sensitive": true},
        "external_reference": {"type": "uuid", "access": "BLOCKED", "sensitive": true},
        "amount": {"type": "decimal", "access": "BLOCKED", "sensitive": true},
        "phone_number": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "status": {"type": "string", "access": "BLOCKED", "sensitive": false}
      }
    },

    "core_otpverification": {
      "description": "OTP codes - NEVER accessible",
      "access_level": "BLOCKED",
      "row_filter": null,
      "columns": {
        "id": {"type": "integer", "access": "BLOCKED", "sensitive": true},
        "user_id": {"type": "integer", "access": "BLOCKED", "sensitive": true},
        "otp_type": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "code": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "expires_at": {"type": "datetime", "access": "BLOCKED", "sensitive": true},
        "is_used": {"type": "boolean", "access": "BLOCKED", "sensitive": true}
      }
    },

    "orgs_membership": {
      "description": "Organization memberships - NEVER accessible via AI",
      "access_level": "BLOCKED",
      "row_filter": null,
      "columns": {
        "id": {"type": "integer", "access": "BLOCKED", "sensitive": false},
        "organization_id": {"type": "integer", "access": "BLOCKED", "sensitive": false},
        "user_id": {"type": "integer", "access": "BLOCKED", "sensitive": true},
        "role": {"type": "string", "access": "BLOCKED", "sensitive": false}
      }
    },

    "tickets_guestsession": {
      "description": "Guest checkout sessions - NEVER accessible",
      "access_level": "BLOCKED",
      "row_filter": null,
      "columns": {
        "id": {"type": "integer", "access": "BLOCKED", "sensitive": true},
        "token": {"type": "uuid", "access": "BLOCKED", "sensitive": true},
        "email": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "name": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "phone": {"type": "string", "access": "BLOCKED", "sensitive": true}
      }
    },

    "ai_aiconversation": {
      "description": "AI conversations - NEVER accessible via AI queries",
      "access_level": "BLOCKED",
      "row_filter": null,
      "columns": {
        "id": {"type": "integer", "access": "BLOCKED", "sensitive": false},
        "session_id": {"type": "uuid", "access": "BLOCKED", "sensitive": false},
        "user_id": {"type": "integer", "access": "BLOCKED", "sensitive": true},
        "context": {"type": "json", "access": "BLOCKED", "sensitive": true}
      }
    },

    "ai_supportticket": {
      "description": "Support tickets - NEVER accessible via AI queries",
      "access_level": "BLOCKED",
      "row_filter": null,
      "columns": {
        "id": {"type": "integer", "access": "BLOCKED", "sensitive": false},
        "reference": {"type": "uuid", "access": "BLOCKED", "sensitive": false},
        "user_id": {"type": "integer", "access": "BLOCKED", "sensitive": true},
        "guest_email": {"type": "string", "access": "BLOCKED", "sensitive": true},
        "subject": {"type": "string", "access": "BLOCKED", "sensitive": false},
        "description": {"type": "text", "access": "BLOCKED", "sensitive": false}
      }
    }
  },

  "sensitive_keywords": [
    "password",
    "token",
    "secret",
    "api_key",
    "credential",
    "otp",
    "verification",
    "session"
  ],

  "blocked_operations": [
    "INSERT",
    "UPDATE",
    "DELETE",
    "DROP",
    "CREATE",
    "ALTER",
    "TRUNCATE",
    "REPLACE",
    "EXEC",
    "EXECUTE"
  ]
}
